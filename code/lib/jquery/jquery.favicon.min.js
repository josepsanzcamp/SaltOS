(function(d){function k(e){d("link[rel$=icon]").replaceWith("");d('<link rel="shortcut icon" type="image/x-icon"/>').appendTo("head").attr("href",e)}var b;d.favicon=function(e,f,c){2==arguments.length&&(c=f);if(c)if(b=b||d("<canvas />")[0],b.getContext){var l=d("<img />")[0];l.onload=function(){d.favicon.unanimate();b.height=b.width=this.width;var h=b.getContext("2d");h.drawImage(this,0,0);c(h);k(b.toDataURL("image/png"))};l.src=e}else k(f||e);else d.favicon.unanimate(),k(e);return this};var a={timer:null,
frames:[],size:16,count:1};d.extend(d.favicon,{animate:function(e,f,c){c=c||{};b=b||d("<canvas />")[0];b.getContext?(f=d("<img />")[0],f.onload=function(){d.favicon.unanimate();a.onStop=c.onStop;a.image=this;b.height=b.width=a.size=this.height;a.count=this.width/this.height;for(var l=[],h=0;h<a.count;++h)l.push(h);a.frames=c.frames||l;var n=b.getContext("2d");c.onStart&&c.onStart();a.timer=setInterval(function(){var m=a.frames.shift();a.frames.push(m);if(m>=a.count)throw clearInterval(a.timer),a.timer=
null,Error("jQuery.favicon.animate: frame #"+m+' do not exists in "'+e+'"');var g=a.size;n.clearRect(0,0,g,g);n.drawImage(a.image,g*m,0,g,g,0,0,g,g);c.onDraw&&c.onDraw(n,m);k(b.toDataURL("image/png"))},c.interval||1E3)},f.src=e):k(f||e)},unanimate:function(){a.timer&&(clearInterval(a.timer),a.timer=null,a.onStop&&a.onStop())}})})(jQuery);
