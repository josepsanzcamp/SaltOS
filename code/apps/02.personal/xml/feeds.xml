<?xml version="1.0" encoding="UTF-8" ?>
<!--
 ____        _ _    ___  ____
/ ___|  __ _| | |_ / _ \/ ___|
\___ \ / _` | | __| | | \___ \
 ___) | (_| | | |_| |_| |___) |
|____/ \__,_|_|\__|\___/|____/

SaltOS: Framework to develop Rich Internet Applications
Copyright (C) 2007-2023 by Josep Sanz CampderrÃ³s
More information in https://www.saltos.org or info@saltos.org

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<root>
    <list>
        <title lang="true">list</title>
        <icon eval="true">ICON("list")</icon>
        <help>true</help>
        <actions include="xml/common/actions.xml" replace="true" />
        <actions path="actions" append="true">
            <forward>
                <label lang="true">actionforward</label>
                <onclick>forward(ID)</onclick>
                <icon eval="true">ICON("forward")</icon>
            </forward>
            <new>
                <label lang="true">actionnew</label>
                <onclick>update_state2(ID,'new',-1);submit1()</onclick>
                <icon eval="true">ICON("tagnew")</icon>
            </new>
            <wait>
                <label lang="true">actionwait</label>
                <onclick>update_state2(ID,'wait',-1);submit1()</onclick>
                <icon eval="true">ICON("tagwait")</icon>
            </wait>
            <cool>
                <label lang="true">actioncool</label>
                <onclick>update_state2(ID,'cool',-1);submit1()</onclick>
                <icon eval="true">ICON("tagcool")</icon>
            </cool>
            <favoritos>
                <label lang="true">actionfavoritos</label>
                <onclick>feed2bookmark(ID)</onclick>
                <icon eval="true">ICON("favoritos")</icon>
            </favoritos>
        </actions>
        <width>100%</width>
        <fields>
<!--
            <field ifeval="!ismobile()">
                <name>id2</name>
                <label lang="true">id</label>
                <sort>true</sort>
                <order>id</order>
            </field>
-->
            <field>
                <name>feed</name>
                <label lang="true">feed</label>
                <sort>true</sort>
                <size>20</size>
                <class>nowrap</class>
            </field>
            <field>
                <name>post</name>
                <label lang="true">post</label>
                <sort>true</sort>
                <size>20</size>
                <class>nowrap</class>
            </field>
            <field>
                <name>title</name>
                <label lang="true">title</label>
                <sort>true</sort>
            </field>
            <field>
                <name>pubdate</name>
                <label lang="true">pubdate</label>
                <sort>true</sort>
                <class>nowrap</class>
            </field>
            <field>
                <name>estado</name>
                <label lang="true">estado</label>
                <width>1px</width>
                <class>estado</class>
            </field>
        </fields>
        <javascript>
            <javascript include="xml/common/jslist.xml" replace="true"/>
            <cache>
                <include>js/updatefeeds.js</include>
                <include>js/feeds.js</include>
            </cache>
            <function>clear2() { setCheck("onlynew",false); setCheck("onlywait",false); setCheck("onlycool",false); }</function>
            <function>stateall2() { clear2(); submit1(); }</function>
            <function>statenew() { clear2(); setCheck("onlynew",true); submit1(); }</function>
            <function>statewait() { clear2(); setCheck("onlywait",true); submit1(); }</function>
            <function>statecool() { clear2(); setCheck("onlycool",true); submit1(); }</function>
            <function>clear3() { setParam("fecha1",""); setParam("fecha2",""); setParam("fecha3",""); }</function>
            <function>stateall3() { clear3(); submit1(); }</function>
            <function>today() { clear3(); setParam('fecha3','today'); submit1(); }</function>
            <function>yesterday() { clear3(); setParam('fecha3','yesterday'); submit1(); }</function>
            <function>week() { clear3(); setParam('fecha3','week'); submit1(); }</function>
            <function>month() { clear3(); setParam('fecha3','month'); submit1(); }</function>
            <function eval="true">"leidos(val) { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgleidos")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','feeds'); setParam('action2','leidos='+val); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
            <function eval="true">"wait(val) { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgwait")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','feeds'); setParam('action2','wait='+val); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
            <function eval="true">"cool(val) { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgcool")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','feeds'); setParam('action2','cool='+val); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
            <function eval="true">"delete2() { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgdelete2")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','feeds'); setParam('action2','delete'); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
            <function>forward(id) { setParam("page","correo"); setParam("action","form"); setParam("id","0_feed_"+id); submit1(); }</function>
        </javascript>
        <form>
            <name>list</name>
            <action></action>
            <method>get</method>
            <fields>
                <title lang="true">filter</title>
                <icon eval="true">ICON("filter")</icon>
                <buttons>true</buttons>
                <popup>true</popup>
                <row>
                    <field include="xml/common/hiddenslist.xml" replace="true" />
                    <field>
                        <name>id_usuario</name>
                        <label lang="true">username</label>
                        <type>select</type>
                        <width>240px</width>
                        <query eval="true">make_extra_query_with_perms("usuarios","tbl_usuarios",array(make_extra_query_with_login(),"id_aplicacion,id_registro,login"),"SELECT id FROM tbl_usuarios WHERE activo=1")." UNION SELECT '' value,'".LANG_ESCAPE("todoslosusuarios")."' label,'-1' pos ORDER BY pos ASC,label ASC,value ASC"</query>
                        <value global="id_usuario" eval="true">$id_usuario=getParam("id_usuario")</value>
                        <onchange>update_feeds();</onchange>
                        <colspan>3</colspan>
                    </field>
                    <field>
                        <type>separator</type>
                        <width>10px</width>
                    </field>
                    <field>
                        <name>id_feed</name>
                        <label lang="true">feed</label>
                        <type>select</type>
                        <width>240px</width>
                        <query eval="true">"SELECT '' value,'".LANG_ESCAPE("todoslosfeeds")."' label"</query>
                        <value global="id_feed" eval="true">$id_feed=getParam("id_feed")</value>
                        <colspan>5</colspan>
                    </field>
                </row>
                <row>
                    <field>
                        <name>filtro</name>
                        <label lang="true">buscar</label>
                        <type>text</type>
                        <width>240px</width>
                        <value global="filtro" eval="true">$filtro=getParam("filtro")</value>
                        <colspan>3</colspan>
                    </field>
                    <field>
                        <type>separator</type>
                    </field>
                    <field>
                        <name>fecha1</name>
                        <label lang="true">fechaini</label>
                        <type>date</type>
                        <width>90px</width>
                        <value global="fecha1" eval="true">$fecha1=getParam("fecha1")</value>
                        <icon eval="true">ICON("calendar")</icon>
                        <onchange>setParam("fecha3",""); check_date("fecha1","le","fecha2")</onchange>
                    </field>
                    <field>
                        <name>fecha2</name>
                        <label lang="true">fechafin</label>
                        <type>date</type>
                        <width>90px</width>
                        <value global="fecha2" eval="true">$fecha2=getParam("fecha2")</value>
                        <class2>right</class2>
                        <icon eval="true">ICON("calendar")</icon>
                        <onchange>setParam("fecha3",""); check_date("fecha2","ge","fecha1")</onchange>
                    </field>
                </row>
                <row>
                    <field>
                        <type>separator</type>
                    </field>
                </row>
                <row>
                    <field>
                        <name>onlynew</name>
                        <label lang="true">onlynew</label>
                        <type>checkbox</type>
                        <value>1</value>
                        <checked global="onlynew" eval="true">(($onlynew=getParam("onlynew"))=="1")?"true":"false"</checked>
                    </field>
                    <field>
                        <name>onlywait</name>
                        <label lang="true">onlywait</label>
                        <type>checkbox</type>
                        <value>1</value>
                        <checked global="onlywait" eval="true">(($onlywait=getParam("onlywait"))=="1")?"true":"false"</checked>
                    </field>
                    <field>
                        <name>onlycool</name>
                        <label lang="true">onlycool</label>
                        <type>checkbox</type>
                        <value>1</value>
                        <checked global="onlycool" eval="true">(($onlycool=getParam("onlycool"))=="1")?"true":"false"</checked>
                    </field>
                    <field>
                        <name>action2</name>
                        <type>hidden</type>
                        <value></value>
                    </field>
                    <field>
                        <name>fecha3</name>
                        <type>hidden</type>
                        <value global="fecha3" eval="true">$fecha3=getParam("fecha3")</value>
                    </field>
                </row>
            </fields>
            <fields include="xml/common/filters.xml" replace="true" />
            <buttons include="xml/common/buttonslist.xml" />
        </form>
        <quick>
            <row>
                <field>
                    <type>copy</type>
                    <name>id_feed</name>
                    <onchange>buscar()</onchange>
                </field>
                <field>
                    <type>separator</type>
                    <width>100%</width>
                </field>
                <field global="limit" ifeval="$limit&gt;=200">
                    <type>label</type>
                    <label global="limit" eval="true">str_replace('$limit',$limit,LANG("biglist"))</label>
                    <tip global="limit" eval="true">str_replace('$limit',$limit,LANG("biglisttip"))</tip>
                    <class>nowrap</class>
                    <class2>info</class2>
                </field>
                <field ifeval="!ismobile() &amp;&amp; check_filter(array('filtro'=>'','id_usuario'=>'','id_feed'=>'','fecha1'=>'','fecha2'=>'','fecha3'=>''))">
                    <type>label</type>
                    <label lang="true">usedfilter</label>
                    <class>nowrap</class>
                    <class2>info</class2>
                </field>
                <field>
                    <type>copy</type>
                    <name>filtro</name>
                    <class>shortcut_ctrl_f</class>
                    <onkey>if(is_enterkey(event)) buscar()</onkey>
                    <focus>true</focus>
                </field>
                <field>
                    <type>copy</type>
                    <name>buscar</name>
                </field>
                <field>
                    <name>recibir</name>
                    <type>button</type>
                    <value lang="true">recibir</value>
                    <tip lang="true">recibirtip</tip>
                    <onclick>if(!is_disabled(this)) check_feeds(1)</onclick>
                    <icon eval="true">ICON("download")</icon>
                    <class>nowrap contextmenu</class>
                </field>
                <field ifeval="!ismobile()">
                    <type>menu</type>
                    <name>options</name>
                    <tip lang="true">optionstip</tip>
                    <class2>nofilter</class2>
                    <option>
                        <label lang="true">options</label>
                        <onclick></onclick>
                    </option>
                    <group>
                        <label lang="true">pdfoptions</label>
                        <option>
                            <label lang="true">pdf</label>
                            <onclick>pdf()</onclick>
                        </option>
                        <option>
                            <label lang="true">view2</label>
                            <onclick>view4()</onclick>
                        </option>
                    </group>
                    <group>
                        <label lang="true">marcarfeeds</label>
                        <option>
                            <label lang="true">leidos</label>
                            <onclick>leidos(0)</onclick>
                        </option>
                        <option>
                            <label lang="true">noleidos</label>
                            <onclick>leidos(1)</onclick>
                        </option>
                        <option>
                            <label lang="true">wait</label>
                            <onclick>wait(1)</onclick>
                        </option>
                        <option>
                            <label lang="true">nowait</label>
                            <onclick>wait(0)</onclick>
                        </option>
                        <option>
                            <label lang="true">cool</label>
                            <onclick>cool(1)</onclick>
                        </option>
                        <option>
                            <label lang="true">nocool</label>
                            <onclick>cool(0)</onclick>
                        </option>
                    </group>
                    <group>
                        <label lang="true">filtrarfeeds</label>
                        <option>
                            <label lang="true">stateall</label>
                            <onclick>stateall2()</onclick>
                            <disabled eval="true">(!getParam("onlynew") &amp;&amp; !getParam("onlywait") &amp;&amp; !getParam("onlycool"))?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">statenew</label>
                            <onclick>statenew()</onclick>
                            <disabled eval="true">(getParam("onlynew") &amp;&amp; !getParam("onlywait") &amp;&amp; !getParam("onlycool"))?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">statewait</label>
                            <onclick>statewait()</onclick>
                            <disabled eval="true">(!getParam("onlynew") &amp;&amp; getParam("onlywait") &amp;&amp; !getParam("onlycool"))?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">statecool</label>
                            <onclick>statecool()</onclick>
                            <disabled eval="true">(!getParam("onlynew") &amp;&amp; !getParam("onlywait") &amp;&amp; getParam("onlycool"))?"true":"false"</disabled>
                        </option>
                    </group>
                    <group>
                        <label lang="true">filtrarfeeds</label>
                        <option>
                            <label lang="true">stateall</label>
                            <onclick>stateall3()</onclick>
                            <disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; !getParam("fecha3"))?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">today</label>
                            <onclick>today()</onclick>
                            <disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="today")?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">yesterday</label>
                            <onclick>yesterday()</onclick>
                            <disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="yesterday")?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">week</label>
                            <onclick>week()</onclick>
                            <disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="week")?"true":"false"</disabled>
                        </option>
                        <option>
                            <label lang="true">month</label>
                            <onclick>month()</onclick>
                            <disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="month")?"true":"false"</disabled>
                        </option>
                    </group>
                </field>
                <field>
                    <type>button</type>
                    <value lang="true">borrar</value>
                    <tip lang="true">borrartip</tip>
                    <onclick>delete2()</onclick>
                    <icon eval="true">ICON("delete")</icon>
                    <class>nowrap contextmenu</class>
                    <class2>shortcut_ctrl_delete</class2>
                </field>
                <field>
                    <type>copy</type>
                    <name>limpiar</name>
                    <class>contextmenu</class>
                </field>
            </row>
        </quick>
        <pager include="xml/common/pagerlist.xml"/>
        <temp global="fecha3_array" eval="true">$fecha3_array=array(""=>"1=1","today"=>"DATE(datetime)=DATE('".current_date()."')","yesterday"=>"DATE(datetime)=DATE('".current_date(-86400)."')","week"=>"DATE(datetime)>=DATE('".current_date(-86400*7)."')","month"=>"DATE(datetime)>=DATE('".current_date(-86400*30)."')")</temp>
        <temp global="fecha3,fecha3_array" eval="true">$fecha3=isset($fecha3_array[$fecha3])?$fecha3:""</temp>
        <temp global="only,onlynew,onlywait,onlycool" eval="true">$only=intval($onlynew).intval($onlywait).intval($onlycool)</temp>
        <temp global="only_array" eval="true">$only_array=array("000"=>"1=1","100"=>"state_new='1'","010"=>"state_wait='1'","110"=>"(state_new='1' OR state_wait='1')","001"=>"state_cool='1'","101"=>"(state_new='1' OR state_cool='1')","011"=>"(state_wait='1' OR state_cool='1')","111"=>"(state_new='1' OR state_wait='1' OR state_cool='1')")</temp>
        <temp global="only,only_array" eval="true">$only=isset($only_array[$only])?$only:"000"</temp>
        <query global="page,filtro,id_usuario,id_feed,fecha1,fecha2,fecha3,fecha3_array,only,only_array" eval="true">"SELECT
            id,id2,
            CONCAT('link:openwin(\"',REPLACE(link2,':','%3A'),'\"):',feed) feed,
            CONCAT('href:',link) post,
            CONCAT('link:openapp(\'feeds\',',-id,'):',title) title,
            pubdate,
            estado,
            id action_id,
            CONCAT(id2,' - ',feed,' - ',title, '(',estado,')') action_title,
            action_style,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_pdf2,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view2,
            CASE (".check_user("correo","create")." AND ".check_sql($page,"view").") WHEN 1 THEN 'true' ELSE 'false' END action_forward,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_new,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_wait,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_cool,
            CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_favoritos,
            CASE ".check_sql($page,"delete")." WHEN 1 THEN 'true' ELSE 'false' END action_delete
        FROM (
            SELECT a.id id,LPAD(a.id,".intval(CONFIG("zero_padding_digits")).",0) id2,
                uf.title feed,
                uf.link link2,
                ".make_extra_query_with_login("d.")." usuario,
                CASE WHEN a.title='' THEN '".LANG_ESCAPE("sintitle")."' ELSE a.title END title,
                pubdate,a.description,a.link link,state_new,state_wait,state_cool,
                CASE WHEN state_new=1 THEN 'state_new'
                    WHEN state_wait=1 THEN 'state_wait'
                    WHEN state_cool=1 THEN 'state_cool'
                    ELSE ''
                END action_style,
                TRIM(CONCAT(
                CASE WHEN state_new=1 AND state_modified=0 THEN '".LANG_ESCAPE("statenew")." ' ELSE '' END,
                CASE state_modified WHEN 1 THEN '".LANG_ESCAPE("statemodified")." ' ELSE '' END,
                CASE state_wait WHEN 1 THEN '".LANG_ESCAPE("statewait")." ' ELSE '' END,
                CASE state_cool WHEN 1 THEN '".LANG_ESCAPE("statecool")." ' ELSE '' END,
                CASE state_new+state_modified+state_wait+state_cool WHEN 0 THEN '".LANG_ESCAPE("stateread")." ' ELSE '' END
                )) estado,
                e.datetime,
                e.id_usuario,d.id_grupo,a.id_feed,uf.id_usuario id_usuario2
            FROM tbl_feeds a
                LEFT JOIN tbl_usuarios_f uf ON a.id_feed=uf.id
                LEFT JOIN tbl_registros e ON e.id_aplicacion='".page2id($page)."' AND e.id_registro=a.id AND e.first=1
                LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id
        ) z
        WHERE ".($id_usuario?"id_usuario2='$id_usuario'":"(1=1)")."
        AND ".($filtro!=""?make_fulltext_query3($filtro,$page):"(1=1)")."
        AND ".($id_feed!=""?"id_feed='$id_feed'":"(1=1)")."
        AND ".$only_array[$only]."
        AND ".($fecha1?"(DATE(pubdate)>=DATE('$fecha1'))":"(1=1)")."
        AND ".($fecha2?"(DATE('$fecha2')>=DATE(pubdate))":"(1=1)")."
        AND ".$fecha3_array[$fecha3]."
        AND ".check_sql($page,"list")</query>
        <order global="order" eval="true">$order</order>
        <limit global="limit" eval="true">$limit</limit>
        <offset global="offset" eval="true">$offset</offset>
    </list>
    <form>
        <views>
            <view>
                <title lang="true">formview</title>
                <query>
                    <query include="xml/common/qpermview.xml" replace="true" />
                    <default global="id" eval="true">"SELECT *,(SELECT CONCAT('openwin(\"',link,'\")') FROM tbl_usuarios_f WHERE id=id_feed) link2,CONCAT('openwin(\"',link,'\")') link,CASE WHEN title='' THEN '".LANG_ESCAPE("sintitle")."' ELSE title END title FROM tbl_feeds WHERE id=".abs($id)</default>
                    <full global="id" eval="true">"SELECT '".abs($id)."' id"</full>
                    <control include="xml/common/qcontrol.xml"/>
                </query>
            </view>
        </views>
        <name>form</name>
        <action></action>
        <method>post</method>
        <hiddens include="xml/common/hiddensform.xml" />
        <help>true</help>
        <fields>
            <default>
                <fieldset>
                    <title lang="true">defaultdata</title>
                    <icon eval="true">ICON("form")</icon>
                    <quick global="id" eval="true">$id>=0?"false":"true"</quick>
                    <buttons>true</buttons>
                    <width>100%</width>
                    <row>
                        <field>
                            <name>id</name>
                            <type>hidden</type>
                        </field>
                        <field>
                            <name>title</name>
                            <label lang="true">title</label>
                            <type>text</type>
                            <readonly>true</readonly>
                            <colspan>10</colspan>
                            <width>calc(100% - 14px)</width>
                            <width2>1%</width2>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>pubdate</name>
                            <label lang="true">pubdate</label>
                            <type>datetime</type>
                            <width>150px</width>
                            <readonly>true</readonly>
                        </field>
                        <field>
                            <type>separator</type>
                        </field>
                        <field>
                            <name>state_new</name>
                            <label lang="true">statenew</label>
                            <type>checkbox</type>
                            <value>1</value>
                            <onchange>if(!$(this).prop("writed")) $(this).prop("checked",true); $(this).prop("writed",true); update_state2(abs(intval(getParam('id'))),'new',this.checked?1:0)</onchange>
                            <readonly global="page,id" eval="true">execute_query("SELECT id_registro FROM tbl_registros WHERE id_aplicacion='".page2id($page)."' AND id_registro='".abs($id)."' AND first=1 AND id_usuario='".current_user()."'")?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                        </field>
                        <field>
                            <name>state_modified</name>
                            <label lang="true">statemodified</label>
                            <type>checkbox</type>
                            <value>1</value>
                            <readonly>true</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                        </field>
                        <field>
                            <name>state_wait</name>
                            <label lang="true">statewait</label>
                            <type>checkbox</type>
                            <value>1</value>
                            <onchange>update_state2(abs(intval(getParam('id'))),'wait',this.checked?1:0)</onchange>
                            <readonly global="page,id" eval="true">execute_query("SELECT id_registro FROM tbl_registros WHERE id_aplicacion='".page2id($page)."' AND id_registro='".abs($id)."' AND first=1 AND id_usuario='".current_user()."'")?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                        </field>
                        <field>
                            <name>state_cool</name>
                            <label lang="true">statecool</label>
                            <type>checkbox</type>
                            <value>1</value>
                            <onchange>update_state2(abs(intval(getParam('id'))),'cool',this.checked?1:0)</onchange>
                            <readonly global="page,id" eval="true">execute_query("SELECT id_registro FROM tbl_registros WHERE id_aplicacion='".page2id($page)."' AND id_registro='".abs($id)."' AND first=1 AND id_usuario='".current_user()."'")?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                        </field>
                    </row>
                    <row>
                        <height>22px</height>
                        <field>
                            <name>link2</name>
                            <type>link</type>
                            <label global="id" eval="true">execute_query("SELECT (SELECT title FROM tbl_usuarios_f WHERE id=id_feed) feed FROM tbl_feeds WHERE id='".abs($id)."'")</label>
                            <colspan>10</colspan>
                            <label2 lang="true">feed</label2>
                        </field>
                    </row>
                    <row>
                        <height>22px</height>
                        <field>
                            <name>link</name>
                            <type>link</type>
                            <label global="id" eval="true">execute_query("SELECT link FROM tbl_feeds WHERE id='".abs($id)."'")</label>
                            <class3>enlace</class3>
                            <colspan>10</colspan>
                            <label2 lang="true">link</label2>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>content</name>
                            <label lang="true">descripcion</label>
                            <type>iframe</type>
                            <value global="id" eval="true">"?action=feeds&amp;id=".abs($id)."&amp;cid=body"</value>
                            <width>calc(100% - 14px)</width>
                            <height>240px</height>
                            <colspan>10</colspan>
                        </field>
                    </row>
                </fieldset>
            </default>
            <full ifeval="!ismobile()">
                <fieldset>
                    <title lang="true">fulldata</title>
                    <icon eval="true">ICON("form")</icon>
                    <width>100%</width>
                    <row>
                        <field>
                            <name>full</name>
                            <type>iframe</type>
                            <value global="id" eval="true">"?action=feeds&amp;id=".abs($id)."&amp;cid=full"</value>
                            <width>100%</width>
                            <height>240px</height>
                            <class>nada</class>
                        </field>
                    </row>
                </fieldset>
            </full>
            <control include="xml/common/control.xml" />
        </fields>
        <quick include="xml/common/quickform.xml" />
        <buttons>
            <row>
                <field>
                    <type>separator</type>
                    <width>100%</width>
                </field>
                <field>
                    <type>button</type>
                    <value lang="true">actionforward</value>
                    <tip lang="true">actionforwardtip</tip>
                    <onclick>forward()</onclick>
                    <class>nowrap contextmenu</class>
                    <icon eval="true">ICON("forward")</icon>
                    <class2>shortcut_ctrl_insert</class2>
                </field>
                <field global="id" ifeval="$id&lt;0">
                    <type>button</type>
                    <name>delete</name>
                    <value lang="true">delete</value>
                    <tip lang="true">delete</tip>
                    <onclick>delete1()</onclick>
                    <disabled global="page,id" eval="true">execute_query("SELECT '1' denied FROM (SELECT a.id,e.id_usuario id_usuario,d.id_grupo id_grupo FROM ".page2table($page)." a LEFT JOIN tbl_registros e ON e.id_aplicacion='".page2id($page)."' AND e.id_registro=a.id AND e.first=1 LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id WHERE a.id='".abs($id)."') z WHERE NOT ".check_sql($page,"delete"))?"true":"false"</disabled>
                    <class>nowrap contextmenu</class>
                    <icon eval="true">ICON("delete")</icon>
                </field>
                <field>
                    <type>button</type>
                    <value lang="true">buttonreturn</value>
                    <tip lang="true">buttonreturn</tip>
                    <onclick>goback()</onclick>
                    <class>nowrap contextmenu</class>
                    <icon eval="true">ICON("back")</icon>
                </field>
            </row>
        </buttons>
        <javascript>
            <javascript include="xml/common/jsform.xml" replace="true"/>
            <function>forward() { setParam("page","correo"); setParam("id","0_feed_"+abs(intval(getParam("id")))); submit1(); }</function>
            <function eval="true">"lang_msgnumsileidos() { return '".LANG_ESCAPE("msgnumsileidos")."1".LANG_ESCAPE("message1")."'; }"</function>
            <function eval="true">"lang_msgnumnoleidos() { return '".LANG_ESCAPE("msgnumnoleidos")."1".LANG_ESCAPE("message1")."'; }"</function>
            <function eval="true">"lang_msgnumsiwait() { return '".LANG_ESCAPE("msgnumsiwait")."1".LANG_ESCAPE("message1")."'; }"</function>
            <function eval="true">"lang_msgnumnowait() { return '".LANG_ESCAPE("msgnumnowait")."1".LANG_ESCAPE("message1")."'; }"</function>
            <function eval="true">"lang_msgnumsicool() { return '".LANG_ESCAPE("msgnumsicool")."1".LANG_ESCAPE("message1")."'; }"</function>
            <function eval="true">"lang_msgnumnocool() { return '".LANG_ESCAPE("msgnumnocool")."1".LANG_ESCAPE("message1")."'; }"</function>
        </javascript>
    </form>
    <delete>
        <query include="xml/common/qpermdelete.xml" replace="true"/>
        <query global="id" eval="true">"INSERT INTO tbl_feeds_d(id_feed,link,datetime) SELECT id_feed,link,'".current_datetime()."' FROM tbl_feeds WHERE id='{$id}'"</query>
        <query include="xml/common/qdelete.xml" replace="true" />
        <query include="xml/common/qcontroldelete.xml" replace="true"/>
        <query eval="true">"SELECT '".LANG_ESCAPE("msgnumdelete")."1".LANG_ESCAPE("message1")."' action_alert"</query>
    </delete>
    <pdf>
        <constructor>"P","mm","A4"</constructor>
        <margins>50,30,30,30</margins>
        <query>"SELECT *,(SELECT CONCAT(title,' (',link,')') FROM tbl_usuarios_f WHERE id=a.id_feed) feed FROM tbl_feeds a WHERE a.id IN (".check_ids(getParam("id")).")"</query>
        <foreach>
            <!-- TEMPLATE -->
            <header>
                <!-- LOGO -->
                <margins>0,0,0,0</margins>
                <image>CONFIG("logo_left"),CONFIG("logo_top"),CONFIG("logo_width"),CONFIG("logo_height"),get_directory("dirs/filesdir").CONFIG("logo_file")</image>
                <!-- PONER MARCA DE AGUA -->
                <font>"normal","B",CONFIG("water_feeds_size"),"#eeeeee"</font>
                <text>CONFIG("water_feeds_posx"),CONFIG("water_feeds_posy"),CONFIG("water_feeds_text"),CONFIG("water_feeds_angle")</text>
                <margins>50,30,30,30</margins>
                <setxy>30,50</setxy>
            </header>
            <footer>
                <margins>0,0,0,0</margins>
                <!-- PONER PIE DE PAGINA -->
                <font>"normal","",6,CONFIG("color_text2")</font>
                <pageno>30,279,150,0,"R",LANG("paginaspc"),LANG("spcdespc")</pageno>
                <margins>50,30,30,30</margins>
            </footer>
            <!-- BEGIN -->
            <newpage></newpage>
            <color>CONFIG("color_line"),"#000000"</color>
            <!-- DATOS FEED -->
            <setxy>30,50</setxy>
            <getxy>"x","y"</getxy>
            <font>"normal","B",8,CONFIG("color_text1")</font>
            <textarea>30,$row["y"],25,4,"R",LANG("title")</textarea>
            <font>"mono","",8,CONFIG("color_text2")</font>
            <textarea>55,$row["y"],125,4,"L",$row["title"]?$row["title"]:LANG("sintitle")</textarea>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <line>30,$row["y"],180,$row["y"]</line>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <font>"normal","B",8,CONFIG("color_text1")</font>
            <textarea>30,$row["y"],25,4,"R",LANG("date")</textarea>
            <font>"mono","",8,CONFIG("color_text2")</font>
            <textarea>55,$row["y"],125,4,"L",$row["pubdate"]</textarea>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <line>30,$row["y"],180,$row["y"]</line>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <font>"normal","B",8,CONFIG("color_text1")</font>
            <textarea>30,$row["y"],25,4,"R",LANG("feed")</textarea>
            <font>"mono","",8,CONFIG("color_text2")</font>
            <textarea>55,$row["y"],125,4,"L",$row["feed"]</textarea>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <line>30,$row["y"],180,$row["y"]</line>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <font>"normal","B",8,CONFIG("color_text1")</font>
            <textarea>30,$row["y"],25,4,"R",LANG("link")</textarea>
            <font>"mono","",8,CONFIG("color_text2")</font>
            <textarea>55,$row["y"],125,4,"L",$row["link"]</textarea>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <line>30,$row["y"],180,$row["y"]</line>
            <getxy>"x","y"</getxy>
            <setxy>$row["x"],$row["y"]+2</setxy>
            <getxy>"x","y"</getxy>
            <font>"normal","B",8,CONFIG("color_text1")</font>
            <textarea>30,$row["y"],25,4,"R",LANG("descripcion")</textarea>
            <font>"mono","",8,CONFIG("color_text2")</font>
            <textarea>55,$row["y"],125,4,"L",trim(html2text($row["description"]))</textarea>
        </foreach>
        <output>encode_bad_chars(str_replace(".","",strpos(check_ids(getParam("id")),",")===false?execute_query("
        SELECT CONCAT('".LANG_ESCAPE("feed")."',' ',LPAD(id,".intval(CONFIG("zero_padding_digits")).",0),' ',CASE WHEN title='' THEN '".LANG_ESCAPE("sintitle")."' ELSE title END) subject
        FROM tbl_feeds WHERE id IN (".check_ids(getParam("id")).")"):LANG("feeds"))).".pdf"</output>
    </pdf>
</root>
