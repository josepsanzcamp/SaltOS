<?xml version="1.0" encoding="UTF-8" ?>
<!--
 ____        _ _    ___  ____
/ ___|  __ _| | |_ / _ \/ ___|
\___ \ / _` | | __| | | \___ \
 ___) | (_| | | |_| |_| |___) |
|____/ \__,_|_|\__|\___/|____/

SaltOS: Framework to develop Rich Internet Applications
Copyright (C) 2007-2019 by Josep Sanz CampderrÃ³s
More information in http://www.saltos.org or info@saltos.org

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<root>
	<list>
		<title lang="true">list</title>
		<icon eval="true">ICON("list")</icon>
		<help>true</help>
		<actions include="xml/common/actions.xml" replace="true" />
		<actions path="actions" append="true">
			<reply>
				<label lang="true">actionreply</label>
				<onclick>reply(ID)</onclick>
				<icon>fa fa-reply</icon>
			</reply>
			<replyall>
				<label lang="true">actionreplyall</label>
				<onclick>replyall(ID)</onclick>
				<icon>fa fa-reply-all</icon>
			</replyall>
			<forward>
				<label lang="true">actionforward</label>
				<onclick>forward(ID)</onclick>
				<icon>fa fa-share</icon>
			</forward>
			<new>
				<label lang="true">actionnew</label>
				<onclick>update_state(ID,'new',-1);submit1()</onclick>
				<icon>fa fa-tag fa-tag-new</icon>
			</new>
			<wait>
				<label lang="true">actionwait</label>
				<onclick>update_state(ID,'wait',-1);submit1()</onclick>
				<icon>fa fa-tag fa-tag-wait</icon>
			</wait>
			<spam>
				<label lang="true">actionspam</label>
				<onclick>update_state(ID,'spam',-1);submit1()</onclick>
				<icon>fa fa-tag fa-tag-spam</icon>
			</spam>
 		</actions>
		<width>100%</width>
		<fields>
<!--
			<field ifeval="!ismobile()">
				<name>id2</name>
				<label lang="true">id</label>
				<sort>true</sort>
				<order>id</order>
			</field>
-->
			<field>
				<name>de2</name>
				<label lang="true">from</label>
				<sort>true</sort>
				<size>25</size>
				<order>de</order>
			</field>
			<field>
				<name>para2</name>
				<label lang="true">to</label>
				<sort>true</sort>
				<size>25</size>
				<order>para</order>
			</field>
			<field>
				<name>subject2</name>
				<label lang="true">subject</label>
				<sort>true</sort>
				<size>50</size>
				<order>subject</order>
			</field>
			<field>
				<name>datetime</name>
				<label lang="true">datetime</label>
				<sort>true</sort>
				<class>nowrap</class>
			</field>
			<field ifeval="!ismobile()">
				<name>size2</name>
				<label lang="true">size</label>
				<sort>true</sort>
				<order>size</order>
				<class>nowrap</class>
			</field>
			<field ifeval="!ismobile()">
				<name>files</name>
				<label lang="true">numf</label>
				<tip lang="true">numftip</tip>
			</field>
			<field>
				<name>estado</name>
				<label lang="true">estado</label>
				<width>1px</width>
				<class>estado</class>
			</field>
		</fields>
		<javascript>
			<javascript include="xml/common/jslist.xml" replace="true"/>
			<cache>
				<include>js/updatecuentas.js</include>
				<include>js/correo.js</include>
			</cache>
			<function>clear1() { setCheck("onlyinbox",false); setCheck("onlyoutbox",false); }</function>
			<function>clear2() { setCheck("onlynew",false); setCheck("onlywait",false); setCheck("onlyspam",false); setCheck("hidespam",false); setCheck("withfiles",false); setCheck("withoutfiles",false); }</function>
			<function>clear3() { setParam("fecha1",""); setParam("fecha2",""); setParam("fecha3",""); }</function>
			<function>stateall1() { clear1(); submit1(); }</function>
			<function>stateinbox() { clear1(); setCheck("onlyinbox",true); submit1(); }</function>
			<function>stateoutbox() { clear1(); setCheck("onlyoutbox",true); submit1(); }</function>
			<function>stateall2() { clear2(); submit1(); }</function>
			<function>statenew() { clear2(); setCheck("onlynew",true); submit1(); }</function>
			<function>statewait() { clear2(); setCheck("onlywait",true); submit1(); }</function>
			<function>statespam() { clear2(); setCheck("onlyspam",true); submit1(); }</function>
			<function>stateall3() { clear3(); submit1(); }</function>
			<function>today() { clear3(); setParam('fecha3','today'); submit1(); }</function>
			<function>yesterday() { clear3(); setParam('fecha3','yesterday'); submit1(); }</function>
			<function>week() { clear3(); setParam('fecha3','week'); submit1(); }</function>
			<function>month() { clear3(); setParam('fecha3','month'); submit1(); }</function>
			<function eval="true">"leidos(val) { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgleidos")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','correo'); setParam('action2','leidos='+val); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
			<function eval="true">"wait(val) { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgwait")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','correo'); setParam('action2','wait='+val); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
			<function eval="true">"spam(val) { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgspam")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','correo'); setParam('action2','spam='+val); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
			<function eval="true">"delete2() { var id=getIds(); if(!id) return; dialog('".LANG_ESCAPE("confirm")."','".LANG_ESCAPE("msgdelete2")."',{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','correo'); setParam('action2','delete'); setParam('id',id); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
			<function>reply(id) { setParam("action","form"); setParam("id","0_reply_"+id); submit1(); }</function>
			<function>replyall(id) { setParam("action","form"); setParam("id","0_replyall_"+id); submit1(); }</function>
			<function>forward(id) { setParam("action","form"); setParam("id","0_forward_"+id); submit1(); }</function>
		</javascript>
		<form>
			<name>list</name>
			<action></action>
			<method>get</method>
			<fields>
				<title lang="true">filter</title>
				<icon eval="true">ICON("filter")</icon>
				<popup>true</popup>
				<row>
					<field include="xml/common/hiddenslist.xml" replace="true" />
					<field>
						<name>id_usuario</name>
						<label lang="true">username</label>
						<type>select</type>
						<width>240px</width>
						<query eval="true">make_extra_query_with_perms("usuarios","tbl_usuarios",array(make_extra_query_with_login(),"id_aplicacion,id_registro,login"),"SELECT id FROM tbl_usuarios WHERE activo=1")." UNION SELECT '' value,'".LANG_ESCAPE("todoslosusuarios")."' label,'-1' pos ORDER BY pos ASC,label ASC,value ASC"</query>
						<value global="id_usuario" eval="true">$id_usuario=getParam("id_usuario")</value>
						<onchange>update_cuentas()</onchange>
						<colspan>3</colspan>
					</field>
					<field>
						<type>separator</type>
						<width>10px</width>
					</field>
					<field>
						<name>id_cuenta</name>
						<label lang="true">cuenta</label>
						<type>select</type>
						<width>240px</width>
						<query eval="true">"SELECT '' value,'".LANG_ESCAPE("todaslascuentas")."' label"</query>
						<value global="id_cuenta" eval="true">$id_cuenta=getParam("id_cuenta")</value>
						<colspan>5</colspan>
					</field>
				</row>
				<row>
					<field>
						<name>campos</name>
						<label lang="true">campos</label>
						<type>select</type>
						<rows>
							<row>
								<label lang="true">allcampos</label>
								<value></value>
							</row>
							<row>
								<label lang="true">onlyemail</label>
								<value>email</value>
							</row>
							<row>
								<label lang="true">onlysubject</label>
								<value>subject</value>
							</row>
							<row>
								<label lang="true">onlybody</label>
								<value>body</value>
							</row>
						</rows>
						<width>240px</width>
						<value global="campos" eval="true">$campos=getParam("campos")</value>
						<colspan>3</colspan>
					</field>
					<field>
						<type>separator</type>
					</field>
					<field>
						<name>fecha1</name>
						<label lang="true">fechaini</label>
						<type>date</type>
						<width>90px</width>
						<value global="fecha1" eval="true">$fecha1=getParam("fecha1")</value>
						<icon>fa fa-calendar</icon>
						<onchange>setParam("fecha3",""); check_date("fecha1","le","fecha2")</onchange>
					</field>
					<field>
						<name>fecha2</name>
						<label lang="true">fechafin</label>
						<type>date</type>
						<width>90px</width>
						<value global="fecha2" eval="true">$fecha2=getParam("fecha2")</value>
						<class2>right</class2>
						<icon>fa fa-calendar</icon>
						<onchange>setParam("fecha3",""); check_date("fecha2","ge","fecha1")</onchange>
					</field>
				</row>
				<row>
					<field>
						<name>filtro</name>
						<label lang="true">buscar</label>
						<type>text</type>
						<width>240px</width>
						<value global="filtro" eval="true">$filtro=getParam("filtro")</value>
						<onchange>copy_value("buscar","filtro");</onchange>
						<colspan>3</colspan>
						<speech>true</speech>
					</field>
				</row>
			</fields>
			<fields>
				<buttons>true</buttons>
				<row>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>1px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>120px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>1px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>120px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>1px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>120px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>1px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>120px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
						<width>1px</width>
					</field>
					<field>
						<type>separator</type>
						<height>0px</height>
					</field>
				</row>
				<row>
					<field>
						<name>onlynew</name>
						<label lang="true">onlynew</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="onlynew" eval="true">(($onlynew=getParam("onlynew"))=="1")?"true":"false"</checked>
					</field>
					<field>
						<name>onlywait</name>
						<label lang="true">onlywait</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="onlywait" eval="true">(($onlywait=getParam("onlywait"))=="1")?"true":"false"</checked>
					</field>
					<field>
						<name>onlyspam</name>
						<label lang="true">onlyspam</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="onlyspam" eval="true">(($onlyspam=getParam("onlyspam"))=="1")?"true":"false"</checked>
						<onchange>$("#hidespam").prop("checked",false)</onchange>
					</field>
					<field>
						<name>withfiles</name>
						<label lang="true">withfiles</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="withfiles" eval="true">(($withfiles=getParam("withfiles"))=="1")?"true":"false"</checked>
						<onchange>$("#withoutfiles").prop("checked",false)</onchange>
					</field>
					<field>
						<name>onlyinbox</name>
						<label lang="true">onlyinbox</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="onlyinbox" eval="true">(($onlyinbox=getParam("onlyinbox"))=="1")?"true":"false"</checked>
						<onchange>$("#onlyoutbox").prop("checked",false)</onchange>
					</field>
				</row>
				<row>
					<field>
						<type>separator</type>
						<colspan>4</colspan>
					</field>
					<field>
						<name>hidespam</name>
						<label lang="true">hidespam</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="hidespam" eval="true">(($hidespam=getParam("hidespam"))=="1")?"true":"false"</checked>
						<onchange>$("#onlyspam").prop("checked",false)</onchange>
					</field>
					<field>
						<name>withoutfiles</name>
						<label lang="true">withoutfiles</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="withoutfiles" eval="true">(($withoutfiles=getParam("withoutfiles"))=="1")?"true":"false"</checked>
						<onchange>$("#withfiles").prop("checked",false)</onchange>
					</field>
					<field>
						<name>onlyoutbox</name>
						<label lang="true">onlyoutbox</label>
						<type>checkbox</type>
						<value>1</value>
						<checked global="onlyoutbox" eval="true">(($onlyoutbox=getParam("onlyoutbox"))=="1")?"true":"false"</checked>
						<onchange>$("#onlyinbox").prop("checked",false)</onchange>
					</field>
					<field>
						<name>action2</name>
						<type>hidden</type>
						<value></value>
					</field>
					<field>
						<name>fecha3</name>
						<type>hidden</type>
						<value global="fecha3" eval="true">$fecha3=getParam("fecha3")</value>
					</field>
				</row>
			</fields>
			<fields include="xml/common/filters.xml" replace="true" />
			<buttons include="xml/common/buttonslist.xml" />
		</form>
		<quick>
			<row>
				<field>
					<type>button</type>
					<value lang="true">create</value>
					<tip lang="true">create</tip>
					<onclick>create()</onclick>
					<icon>fa fa-plus-circle</icon>
					<class>nowrap contextmenu</class>
					<class2>shortcut_ctrl_insert</class2>
					<disabled global="page" eval="true">check_user($page,"create")?"false":"true"</disabled>
				</field>
				<field>
					<type>separator</type>
					<width>100%</width>
				</field>
				<field global="limit" ifeval="$limit&gt;=200">
					<type>label</type>
					<label global="limit" eval="true">str_replace('$limit',$limit,LANG("biglist"))</label>
					<tip global="limit" eval="true">str_replace('$limit',$limit,LANG("biglisttip"))</tip>
					<class>nowrap</class>
					<class2>info</class2>
				</field>
				<field ifeval="!ismobile() &amp;&amp; check_filter(array('filtro'=>'','id_usuario'=>'','id_cuenta'=>'','onlynew'=>'','onlywait'=>'','hidespam'=>'','onlyspam'=>'','withfiles'=>'','withoutfiles'=>'','onlyinbox'=>'','onlyoutbox'=>'','fecha1'=>'','fecha2'=>'','campos'=>'','fecha3'=>''))">
					<type>label</type>
					<label lang="true">usedfilter</label>
					<class>nowrap</class>
					<class2>info</class2>
				</field>
				<field>
					<name>buscar</name>
					<label lang="true">buscar</label>
					<type>text</type>
					<width>240px</width>
					<value global="filtro" eval="true">$filtro=getParam("filtro")</value>
					<onchange>copy_value("filtro","buscar");</onchange>
					<onkey>if(is_enterkey(event)) { copy_value("filtro","buscar");buscar(); }</onkey>
					<focus>true</focus>
					<speech>true</speech>
					<class3>shortcut_ctrl_f</class3>
				</field>
				<field>
					<type>button</type>
					<value lang="true">buscar</value>
					<tip lang="true">buscartip</tip>
					<onclick>buscar()</onclick>
					<icon>fa fa-search</icon>
					<class>nowrap</class>
				</field>
				<field>
					<name>recibir</name>
					<type>button</type>
					<value lang="true">recibir</value>
					<tip lang="true">recibirtip</tip>
					<onclick>if(!is_disabled(this)) check_inbox(1)</onclick>
					<icon>fa fa-download</icon>
					<class>nowrap contextmenu</class>
				</field>
				<field>
					<type>button</type>
					<name>enviar</name>
					<value lang="true">enviar</value>
					<tip lang="true">enviartip</tip>
					<onclick>if(!is_disabled(this)) check_outbox(1)</onclick>
					<icon>fa fa-paper-plane</icon>
					<class>nowrap contextmenu</class>
					<disabled eval="true">execute_query("SELECT COUNT(*) FROM tbl_correo a LEFT JOIN tbl_registros e ON e.id_aplicacion='".page2id("correo")."' AND e.id_registro=a.id AND e.first=1 WHERE e.id_usuario='".current_user()."' AND a.is_outbox='1' AND a.state_sent='0'")==0?"true":"false"</disabled>
				</field>
				<field ifeval="!ismobile()">
					<type>menu</type>
					<name>options</name>
					<tip lang="true">optionstip</tip>
					<option>
						<label lang="true">options</label>
						<onclick></onclick>
					</option>
					<group>
						<label lang="true">pdfoptions</label>
						<option>
							<label lang="true">pdf</label>
							<onclick>pdf()</onclick>
						</option>
						<option>
							<label lang="true">view2</label>
							<onclick>view4()</onclick>
						</option>
					</group>
					<group>
						<label lang="true">marcarcorreos</label>
						<option>
							<label lang="true">leidos</label>
							<onclick>leidos(0)</onclick>
						</option>
						<option>
							<label lang="true">noleidos</label>
							<onclick>leidos(1)</onclick>
						</option>
						<option>
							<label lang="true">wait</label>
							<onclick>wait(1)</onclick>
						</option>
						<option>
							<label lang="true">nowait</label>
							<onclick>wait(0)</onclick>
						</option>
						<option>
							<label lang="true">spam</label>
							<onclick>spam(1)</onclick>
						</option>
						<option>
							<label lang="true">nospam</label>
							<onclick>spam(0)</onclick>
						</option>
					</group>
					<group>
						<label lang="true">filtrarcorreos</label>
						<option>
							<label lang="true">stateall</label>
							<onclick>stateall1()</onclick>
							<disabled eval="true">(!getParam("onlyinbox") &amp;&amp; !getParam("onlyoutbox"))?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">stateinbox</label>
							<onclick>stateinbox()</onclick>
							<disabled eval="true">(getParam("onlyinbox") &amp;&amp; !getParam("onlyoutbox"))?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">stateoutbox</label>
							<onclick>stateoutbox()</onclick>
							<disabled eval="true">(!getParam("onlyinbox") &amp;&amp; getParam("onlyoutbox"))?"true":"false"</disabled>
						</option>
					</group>
					<group>
						<label lang="true">filtrarcorreos</label>
						<option>
							<label lang="true">stateall</label>
							<onclick>stateall2()</onclick>
							<disabled eval="true">(!getParam("onlynew") &amp;&amp; !getParam("onlywait") &amp;&amp; !getParam("hidespam") &amp;&amp; !getParam("onlyspam") &amp;&amp; !getParam("withfiles") &amp;&amp; !getParam("withoutfiles"))?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">statenew</label>
							<onclick>statenew()</onclick>
							<disabled eval="true">(getParam("onlynew") &amp;&amp; !getParam("onlywait") &amp;&amp; !getParam("hidespam") &amp;&amp; !getParam("onlyspam") &amp;&amp; !getParam("withfiles") &amp;&amp; !getParam("withoutfiles"))?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">statewait</label>
							<onclick>statewait()</onclick>
							<disabled eval="true">(!getParam("onlynew") &amp;&amp; getParam("onlywait") &amp;&amp; !getParam("hidespam") &amp;&amp; !getParam("onlyspam") &amp;&amp; !getParam("withfiles") &amp;&amp; !getParam("withoutfiles"))?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">statespam</label>
							<onclick>statespam()</onclick>
							<disabled eval="true">(!getParam("onlynew") &amp;&amp; !getParam("onlywait") &amp;&amp; !getParam("hidespam") &amp;&amp; getParam("onlyspam") &amp;&amp; !getParam("withfiles") &amp;&amp; !getParam("withoutfiles"))?"true":"false"</disabled>
						</option>
					</group>
					<group>
						<label lang="true">filtrarcorreos</label>
						<option>
							<label lang="true">stateall</label>
							<onclick>stateall3()</onclick>
							<disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; !getParam("fecha3"))?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">today</label>
							<onclick>today()</onclick>
							<disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="today")?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">yesterday</label>
							<onclick>yesterday()</onclick>
							<disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="yesterday")?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">week</label>
							<onclick>week()</onclick>
							<disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="week")?"true":"false"</disabled>
						</option>
						<option>
							<label lang="true">month</label>
							<onclick>month()</onclick>
							<disabled eval="true">(!getParam("fecha1") &amp;&amp; !getParam("fecha2") &amp;&amp; getParam("fecha3")=="month")?"true":"false"</disabled>
						</option>
					</group>
				</field>
				<field>
					<type>button</type>
					<value lang="true">borrar</value>
					<tip lang="true">borrartip</tip>
					<onclick>delete2()</onclick>
					<icon>fa fa-trash</icon>
					<class>nowrap contextmenu</class>
					<class2>shortcut_ctrl_delete</class2>
				</field>
				<field>
					<type>button</type>
					<value lang="true">limpiar</value>
					<tip lang="true">limpiartip</tip>
					<onclick>limpiar()</onclick>
					<icon>fa fa-refresh</icon>
					<class>nowrap contextmenu</class>
				</field>
			</row>
		</quick>
		<pager include="xml/common/pagerlist.xml"/>
		<temp global="campos_array" eval="true">$campos_array=array(""=>"","email"=>"de,para,cc,bcc","subject"=>"subject","body"=>"body")</temp>
		<temp global="campos,campos_array" eval="true">$campos=isset($campos_array[$campos])?$campos:""</temp>
		<temp global="fecha3_array" eval="true">$fecha3_array=array(""=>"1=1","today"=>"DATE(datetime)=DATE('".current_date()."')","yesterday"=>"DATE(datetime)=DATE('".current_date(-86400)."')","week"=>"DATE(datetime)>=DATE('".current_date(-86400*7)."')","month"=>"DATE(datetime)>=DATE('".current_date(-86400*30)."')")</temp>
		<temp global="fecha3,fecha3_array" eval="true">$fecha3=isset($fecha3_array[$fecha3])?$fecha3:""</temp>
		<temp global="only,onlynew,onlywait,onlyspam" eval="true">$only=intval($onlynew).intval($onlywait).intval($onlyspam)</temp>
		<temp global="only_array" eval="true">$only_array=array("000"=>"1=1","100"=>"state_new='1'","010"=>"state_wait='1'","110"=>"(state_new='1' OR state_wait='1')","001"=>"state_spam='1'","101"=>"(state_new='1' OR state_spam='1')","011"=>"(state_wait='1' OR state_spam='1')","111"=>"(state_new='1' OR state_wait='1' OR state_spam='1')")</temp>
		<temp global="only,only_array" eval="true">$only=isset($only_array[$only])?$only:"000"</temp>
		<query global="page,filtro,id_usuario,id_cuenta,hidespam,withfiles,withoutfiles,onlyinbox,onlyoutbox,fecha1,fecha2,campos,fecha3,campos_array,fecha3_array,only,only_array" eval="true">"SELECT
			id,id2,
			CONCAT('mailto:',de) de2,
			CASE WHEN para!='' THEN CONCAT('mailto:',para)
			ELSE
				(SELECT
					CASE WHEN email_name='' THEN CONCAT('mailto:',email_from) ELSE
					CONCAT('mailto:',email_name,' &lt;',email_from,'&gt;') END
				FROM tbl_usuarios_c WHERE id=id_cuenta)
			END para2,
			CONCAT('link:openapp(\'correo\',',-id,'):',subject) subject2,
			datetime,
			CASE
				WHEN size&gt;=1073741824 THEN CONCAT(ROUND(size/1073741824.0,2),' Gbytes')
				WHEN size&gt;=1048576 THEN CONCAT(ROUND(size/1048576.0,2),' Mbytes')
				WHEN size&gt;=1024 THEN CONCAT(ROUND(size/1024.0,2),' Kbytes')
				ELSE CONCAT(size,' bytes')
			END size2,
			files,
			estado,
			id action_id,
			CONCAT(id2,' - ',de,' - ',subject,' (',estado,')') action_title,
			action_style,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_pdf2,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view2,
			CASE (".check_user($page,"create")." AND ".check_sql($page,"view").") WHEN 1 THEN CASE is_outbox WHEN '0' THEN 'true' ELSE 'false' END ELSE 'false' END action_reply,
			CASE (".check_user($page,"create")." AND ".check_sql($page,"view").") WHEN 1 THEN CASE is_outbox WHEN '0' THEN CASE WHEN (SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo=z.id AND id_tipo IN (2,3))&gt;1 THEN 'true' ELSE 'false' END ELSE 'false' END ELSE 'false' END action_replyall,
			CASE (".check_user($page,"create")." AND ".check_sql($page,"view").") WHEN 1 THEN 'true' ELSE 'false' END action_forward,
			CASE ".check_sql($page,"view")." WHEN 1 THEN CASE is_outbox WHEN '0' THEN 'true' ELSE 'false' END ELSE 'false' END action_new,
			CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_wait,
			CASE ".check_sql($page,"view")." WHEN 1 THEN CASE is_outbox WHEN '0' THEN 'true' ELSE 'false' END ELSE 'false' END action_spam,
			CASE ".check_sql($page,"delete")." WHEN 1 THEN 'true' ELSE 'false' END action_delete
		FROM (
			SELECT a.id,LPAD(a.id,".intval(CONFIG("zero_padding_digits")).",0) id2,
				de,para,cc,bcc,
				a.datetime,size,files,
				id_usuario,id_grupo,id_cuenta,
				state_new,state_wait,state_spam,is_outbox,
				CASE WHEN subject='' THEN '".LANG_ESCAPE("sinsubject")."' ELSE subject END subject,
				body,
				TRIM(CONCAT(
				CASE state_sent WHEN 1 THEN '".LANG_ESCAPE("statesent")." ' ELSE '' END,
				CASE state_error WHEN '' THEN '' ELSE '".LANG_ESCAPE("stateerror")." ' END,
				CASE WHEN is_outbox=1 AND state_sent=0 AND state_error='' THEN ' ".LANG_ESCAPE("statenotsent")."' ELSE '' END,
				CASE state_new WHEN 1 THEN '".LANG_ESCAPE("statenew")." ' ELSE '' END,
				CASE state_reply WHEN 1 THEN '".LANG_ESCAPE("statereply")." ' ELSE '' END,
				CASE state_forward WHEN 1 THEN '".LANG_ESCAPE("stateforward")." ' ELSE '' END,
				CASE state_wait WHEN 1 THEN '".LANG_ESCAPE("statewait")." ' ELSE '' END,
				CASE state_spam WHEN 1 THEN '".LANG_ESCAPE("statespam")." ' ELSE '' END,
				CASE priority WHEN -1 THEN '".LANG_ESCAPE("prioritylow")." ' WHEN 1 THEN '".LANG_ESCAPE("priorityhigh")." ' ELSE '' END,
				CASE sensitivity WHEN 1 THEN '".LANG_ESCAPE("sensitivitypersonal")." ' WHEN 2 THEN '".LANG_ESCAPE("sensitivityprivate")." ' WHEN 3 THEN '".LANG_ESCAPE("sensitivityconfidential")." ' ELSE '' END,
				CASE is_outbox+state_new+state_reply+state_forward+state_wait+state_spam+priority*10+sensitivity WHEN 0 THEN '".LANG_ESCAPE("stateread")." ' ELSE '' END
				)) estado,
				CASE WHEN state_error!='' THEN 'state_error'
					WHEN state_spam=1 THEN 'state_spam'
					WHEN state_new=1 THEN 'state_new'
					WHEN state_wait=1 THEN 'state_wait'
					WHEN is_outbox=1 AND state_sent=0 THEN 'state_nowrap'
					ELSE ''
				END action_style
			FROM tbl_correo a
				LEFT JOIN tbl_registros e ON e.id_aplicacion='".page2id($page)."' AND e.id_registro=a.id AND e.first=1
				LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id
		) z
		WHERE ".make_like_query($campos_array[$campos],$filtro)."
		AND ".($filtro!=""?"id IN (SELECT id_registro FROM tbl_indexing WHERE ".make_fulltext_query2($filtro,page2id($page)).")":"(1=1)")."
		AND ".($id_usuario!=""?"id_usuario='$id_usuario'":"(1=1)")."
		AND ".($id_cuenta!=""?"id_cuenta='$id_cuenta'":"(1=1)")."
		AND ".$only_array[$only]."
		AND ".($hidespam?"state_spam='0'":"(1=1)")."
		AND ".($withfiles?"files&gt;0":"(1=1)")."
		AND ".($withoutfiles?"files=0":"(1=1)")."
		AND ".($onlyinbox?"is_outbox=0":"(1=1)")."
		AND ".($onlyoutbox?"is_outbox=1":"(1=1)")."
		AND id_cuenta NOT IN (SELECT id FROM tbl_usuarios_c WHERE email_privated='1' AND id_usuario!='".current_user()."')
		AND ".($fecha1?"(DATE(datetime)&gt;=DATE('$fecha1'))":"(1=1)")."
		AND ".($fecha2?"(DATE('$fecha2')&gt;=DATE(datetime))":"(1=1)")."
		AND ".$fecha3_array[$fecha3]."
		AND ".check_sql($page,"list")</query>
		<order global="order" eval="true">$order</order>
		<limit global="limit" eval="true">$limit</limit>
		<offset global="offset" eval="true">$offset</offset>
	</list>
	<form>
		<views>
			<view>
				<title lang="true">formview</title>
				<query>
					<query include="xml/common/qpermview.xml" replace="true" />
					<default global="id" eval="true">"SELECT a.id,a.id_cuenta,a.uidl,a.datetime,a.size,
					a.state_new,a.state_reply,a.state_forward,a.state_wait,a.state_spam,a.is_outbox,a.state_sent,a.state_error,a.state_crt,a.priority,a.sensitivity,
					a.de,a.cc,a.bcc,
					CASE WHEN para!='' THEN para
					ELSE
						CASE WHEN uc.email_name=''
						THEN uc.email_from
						ELSE CONCAT(uc.email_name,' &lt;',uc.email_from,'&gt;')
						END
					END para,
					CASE WHEN subject='' THEN '".LANG("sinsubject")."' ELSE subject END subject,
					CONCAT(id_cuenta,'/',uidl) msgid,
					(SELECT REPLACE(GROUP_CONCAT(CONCAT(fichero,' (',fichero_size,')')),',',' | ') FROM
						(SELECT fichero,id_registro,
							CASE
								WHEN fichero_size&gt;=1073741824 THEN CONCAT(ROUND(fichero_size/1073741824.0,2),' Gbytes')
								WHEN fichero_size&gt;=1048576 THEN CONCAT(ROUND(fichero_size/1048576.0,2),' Mbytes')
								WHEN fichero_size&gt;=1024 THEN CONCAT(ROUND(fichero_size/1024.0,2),' Kbytes')
								ELSE CONCAT(fichero_size,' bytes')
							END fichero_size
						 FROM tbl_ficheros WHERE id_aplicacion='".page2id("correo")."') z WHERE id_registro=a.id
					) files
					FROM tbl_correo a
					LEFT JOIN tbl_usuarios_c uc ON a.id_cuenta=uc.id
					WHERE a.id='".abs($id)."'"</default>
					<files_old>
						<files_old>SELECT 'php/action/getmail.php' action_include</files_old>
					</files_old>
					<full global="id" eval="true">"SELECT '".abs($id)."' id"</full>
					<source global="id" eval="true">"SELECT '".abs($id)."' id"</source>
					<control include="xml/common/qcontrol.xml"/>
					<folders include="xml/common/qfolders.xml" />
				</query>
			</view>
			<insert>
				<title lang="true">forminsert</title>
				<query>
					<query include="xml/common/qpermcreate.xml" replace="true" />
					<default>SELECT 'php/action/sendmail.php' action_include</default>
					<files_old>
						<files_old>SELECT 'php/action/getmail.php' action_include</files_old>
					</files_old>
					<files_new include="xml/common/qfilesnew.xml" replace="true"/>
					<folders include="xml/common/qfolders.xml" />
				</query>
			</insert>
		</views>
		<name>form</name>
		<action></action>
		<method>post</method>
		<hiddens include="xml/common/hiddensform.xml" />
		<help>true</help>
		<fields>
			<default>
				<fieldset>
					<title lang="true">defaultdata</title>
					<icon eval="true">ICON("form")</icon>
					<quick global="id" eval="true">$id>=0?"false":"true"</quick>
					<buttons>true</buttons>
					<width>100%</width>
					<row>
						<field>
							<name>id</name>
							<type>hidden</type>
						</field>
						<field>
							<name>id_extra</name>
							<type>hidden</type>
						</field>
						<field global="id" ifeval="$id&lt;0">
							<name>de</name>
							<label lang="true">from</label>
							<type>text</type>
							<width>calc(100% - 14px)</width>
							<readonly>true</readonly>
							<colspan>12</colspan>
						</field>
						<field global="id" ifeval="$id&gt;=0">
							<name>id_cuenta</name>
							<label lang="true">from</label>
							<type>select</type>
							<width>calc(100% - 9px)</width>
							<colspan>12</colspan>
							<query eval="true">"SELECT
							CONCAT(email_name,' &lt;',email_from,'&gt;') label,id value,email_default,(SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo IN (SELECT id FROM tbl_correo WHERE id_cuenta=a.id AND is_outbox=1) AND id_tipo IN (1,2,3,4)) contador FROM tbl_usuarios_c a WHERE id_usuario='".current_user()."' AND email_disabled='0' AND smtp_host!='' ORDER BY email_default DESC, contador DESC"</query>
							<focus>true</focus>
							<required>true</required>
							<onchange>update_signature(1)</onchange>
						</field>
					</row>
					<row>
						<field>
							<name>para</name>
							<label lang="true">to</label>
							<type>text</type>
							<width>calc(100% - 14px)</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<colspan>12</colspan>
							<required global="id" eval="true">$id>=0?"true":"false"</required>
							<speech>true</speech>
							<width2>1%</width2>
						</field>
						<field global="id" ifeval="!ismobile() &amp;&amp; $id&gt;=0">
							<type>button</type>
							<icon>fa fa-trash</icon>
							<value></value>
							<tip lang="true">delete</tip>
							<onclick>$("input[name$='_para']").val("")</onclick>
							<class>nowrap</class>
							<width>1%</width>
						</field>
					</row>
					<row>
						<field global="id" ifeval="execute_query('SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo='.abs($id).' AND id_tipo=3') || ($id==0)">
							<name>cc</name>
							<label lang="true">cc</label>
							<type>text</type>
							<width>calc(100% - 14px)</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<colspan>12</colspan>
							<speech>true</speech>
						</field>
						<field global="id" ifeval="!ismobile() &amp;&amp; $id&gt;=0">
							<type>button</type>
							<icon>fa fa-trash</icon>
							<value></value>
							<tip lang="true">delete</tip>
							<onclick>$("input[name$='_cc']").val("")</onclick>
							<class>nowrap</class>
						</field>
					</row>
					<row>
						<field global="id" ifeval="execute_query('SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo='.abs($id).' AND id_tipo=4') || ($id==0)">
							<name>bcc</name>
							<label lang="true">bcc</label>
							<type>text</type>
							<width>calc(100% - 14px)</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<colspan>12</colspan>
							<speech>true</speech>
						</field>
						<field global="id" ifeval="!ismobile() &amp;&amp; $id&gt;=0">
							<type>button</type>
							<icon>fa fa-trash</icon>
							<value></value>
							<tip lang="true">delete</tip>
							<onclick>$("input[name$='_bcc']").val("")</onclick>
							<class>nowrap</class>
						</field>
					</row>
					<row global="id" ifeval="$id&lt;0">
						<field>
							<name>datetime</name>
							<label lang="true">datetime</label>
							<type>datetime</type>
							<width>150px</width>
							<readonly>true</readonly>
							<icon>fa fa-calendar</icon>
							<icon2>fa fa-clock-o</icon2>
						</field>
						<field>
							<name>msgid</name>
							<label lang="true">messageid</label>
							<type>text</type>
							<width>150px</width>
							<width2>150px</width2>
							<readonly>true</readonly>
						</field>
						<field global="id" ifeval="!execute_query('SELECT is_outbox FROM tbl_correo WHERE id='.abs($id))">
							<name>state_new</name>
							<label lang="true">statenew</label>
							<type>checkbox</type>
							<value>1</value>
							<onchange>if(!$(this).prop("writed")) $(this).prop("checked",true); $(this).prop("writed",true); update_state(abs(getParam('id')),'new',this.checked?1:0)</onchange>
							<readonly global="page,id" eval="true">execute_query("SELECT id_registro FROM tbl_registros WHERE id_aplicacion='".page2id($page)."' AND id_registro='".abs($id)."' AND first=1 AND id_usuario='".current_user()."'")?"false":"true"</readonly>
							<width>100px</width>
							<width2>100px</width2>
						</field>
						<field global="id" ifeval="!execute_query('SELECT is_outbox FROM tbl_correo WHERE id='.abs($id))">
							<name>state_reply</name>
							<label lang="true">statereply</label>
							<type>checkbox</type>
							<value>1</value>
							<readonly>true</readonly>
							<width>1px</width>
							<width2>100px</width2>
						</field>
						<field global="id" ifeval="execute_query('SELECT is_outbox FROM tbl_correo WHERE id='.abs($id))">
							<name>state_sent</name>
							<label lang="true">statesent</label>
							<type>checkbox</type>
							<value>1</value>
							<readonly>true</readonly>
							<width>100px</width>
							<width2>100px</width2>
						</field>
						<field>
							<name>state_forward</name>
							<label lang="true">stateforward</label>
							<type>checkbox</type>
							<value>1</value>
							<readonly>true</readonly>
							<width>1px</width>
							<width2>100px</width2>
						</field>
						<field>
							<name>state_wait</name>
							<label lang="true">statewait</label>
							<type>checkbox</type>
							<value>1</value>
							<onchange>update_state(abs(getParam('id')),'wait',this.checked?1:0)</onchange>
							<readonly global="page,id" eval="true">execute_query("SELECT id_registro FROM tbl_registros WHERE id_aplicacion='".page2id($page)."' AND id_registro='".abs($id)."' AND first=1 AND id_usuario='".current_user()."'")?"false":"true"</readonly>
							<width>1px</width>
							<width2>100px</width2>
						</field>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row>
						<field>
							<name>state_crt</name>
							<label lang="true">confirmreadingto</label>
							<type>checkbox</type>
							<value>1</value>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<width2>150px</width2>
						</field>
						<field>
							<name>priority</name>
							<label lang="true">priority</label>
							<type>select</type>
							<query eval="true">"SELECT '".LANG("prioritylow")."' label,'-1' value UNION SELECT '".LANG("prioritynormal")."' label,'0' value UNION SELECT '".LANG("priorityhigh")."' label,'1' value ORDER BY value ASC"</query>
							<width>90px</width>
							<width2>150px</width2>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
						</field>
						<field>
							<name>sensitivity</name>
							<label lang="true">sensitivity</label>
							<type>select</type>
							<query eval="true">"SELECT '".LANG("sensitivitynormal")."' label,'0' value UNION SELECT '".LANG("sensitivitypersonal")."' label,'1' value UNION SELECT '".LANG("sensitivityprivate")."' label,'2' value UNION SELECT '".LANG("sensitivityconfidential")."' label,'3' value ORDER BY value ASC"</query>
							<width>90px</width>
							<width2>150px</width2>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<colspan global="id" eval="true">$id>=0?"1":"4"</colspan>
							<colspan2 global="id" eval="true">$id>=0?"1":"2"</colspan2>
						</field>
						<field global="id" ifeval="!(execute_query('SELECT is_outbox FROM tbl_correo WHERE id='.abs($id)) || $id&gt;=0)">
							<name>state_spam</name>
							<label lang="true">statespam</label>
							<type>checkbox</type>
							<value>1</value>
							<onchange>update_state(abs(getParam('id')),'spam',this.checked?1:0)</onchange>
							<readonly global="page,id" eval="true">execute_query("SELECT id_registro FROM tbl_registros WHERE id_aplicacion='".page2id($page)."' AND id_registro='".abs($id)."' AND first=1 AND id_usuario='".current_user()."'")?"false":"true"</readonly>
							<width>1px</width>
							<width2>100px</width2>
						</field>
						<field>
							<type>separator</type>
						</field>
					</row>
					<row global="id" ifeval="execute_query('SELECT is_outbox FROM tbl_correo WHERE id='.abs($id).' AND LENGTH(state_error)>0')">
						<field>
							<name>state_error</name>
							<type>text</type>
							<label lang="true">error</label>
							<width>calc(100% - 14px)</width>
							<class3>ui-state-error</class3>
							<class2>state_error</class2>
							<colspan>12</colspan>
							<readonly>true</readonly>
						</field>
					</row>
					<row>
						<field>
							<name>subject</name>
							<label lang="true">subject</label>
							<type>text</type>
							<width>calc(100% - 14px)</width>
							<readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
							<colspan>12</colspan>
							<required global="id" eval="true">$id>=0?"true":"false"</required>
							<speech>true</speech>
						</field>
					</row>
					<temp global="id_extra" eval="true">$id_extra=explode("_",getParam("id"),3);</temp>
					<temp global="id_extra" eval="true">$id_extra[1]=isset($id_extra[1])?$id_extra[1]:""</temp>
					<temp global="id_extra" eval="true">$id_extra[2]=isset($id_extra[2])?$id_extra[2]:""</temp>
					<row global="id,id_extra" ifeval="execute_query('SELECT files FROM tbl_correo WHERE id='.abs($id)) || ($id_extra[1]=='forward' &amp;&amp; execute_query('SELECT files FROM tbl_correo WHERE id='.$id_extra[2])) || $id_extra[1]=='session'">
						<field>
							<label lang="true">attachments</label>
							<type>label</type>
							<class>right</class>
							<height>22px</height>
						</field>
						<field>
							<name>files</name>
							<type>label</type>
							<colspan>12</colspan>
							<class>siwrap</class>
						</field>
					</row>
					<row>
						<field global="id" ifeval="$id&gt;=0">
							<name>body</name>
							<label lang="true">message</label>
							<type>textarea</type>
							<width>calc(100% - 14px)</width>
							<height>240px</height>
							<colspan>12</colspan>
							<required>true</required>
							<ckeditor>true</ckeditor>
							<ckextra>signature; blockquote div{*}</ckextra>
						</field>
						<field global="id" ifeval="$id&lt;0">
							<name>message</name>
							<label lang="true">message</label>
							<type>iframe</type>
							<value global="id" eval="true">"?action=getmail&amp;id=".abs($id)."&amp;cid=body"</value>
							<width>calc(100% - 14px)</width>
							<height>240px</height>
							<colspan>12</colspan>
						</field>
					</row>
					<row global="id" ifeval="!ismobile() &amp;&amp; $id&gt;=0">
						<field>
							<type>grid</type>
							<label lang="true">textos</label>
							<rows>
								<row>
									<field>
										<name>textos_body</name>
										<type>select</type>
										<width>240px</width>
										<query include="xml/common/qtextos.xml" replace="true"/>
										<value></value>
									</field>
									<field>
										<type>button</type>
										<value lang="true">textos_add</value>
										<icon>fa fa-plus-circle</icon>
										<onclick>add_textos_ckeditor('textos_body','body')</onclick>
										<class>nowrap</class>
									</field>
								</row>
							</rows>
							<colspan>12</colspan>
						</field>
					</row>
				</fieldset>
			</default>
			<files_old include="xml/common/filesold.xml" />
			<files_new include="xml/common/filesnew.xml"/>
			<full ifeval="!ismobile()">
				<fieldset>
					<title lang="true">fulldata</title>
					<icon eval="true">ICON("form")</icon>
					<width>100%</width>
					<row>
						<field>
							<name>full</name>
							<type>iframe</type>
							<value global="id" eval="true">"?action=getmail&amp;id=".abs($id)."&amp;cid=full"</value>
							<width>100%</width>
							<height>240px</height>
							<class>nada</class>
						</field>
					</row>
				</fieldset>
			</full>
			<source ifeval="!ismobile()">
				<fieldset>
					<title lang="true">sourcedata</title>
					<icon eval="true">ICON("form")</icon>
					<width>100%</width>
					<row>
						<field>
							<name>source</name>
							<type>iframe</type>
							<value global="id" eval="true">"?action=getmail&amp;id=".abs($id)."&amp;cid=source"</value>
							<width>100%</width>
							<height>240px</height>
							<class>nada</class>
						</field>
					</row>
				</fieldset>
			</source>
			<control include="xml/common/control.xml" />
			<folders include="xml/common/folders.xml" />
		</fields>
		<quick include="xml/common/quickform.xml" />
		<buttons>
			<row>
				<field global="id" ifeval="$id&lt;0 &amp;&amp; !ismobile()">
					<type>button</type>
					<value lang="true">addincidencia</value>
					<tip lang="true">addincidenciatip</tip>
					<onclick>addincidencia()</onclick>
					<disabled global="page,action,id,ok" require="php/action/incidencias.php" eval="true">$ok?"false":"true"</disabled>
					<class>nowrap contextmenu</class>
					<icon>fa fa-bug</icon>
				</field>
				<field>
					<type>separator</type>
					<width>100%</width>
				</field>
				<field global="id" ifeval="$id==0">
					<type>button</type>
					<value lang="true">buttonsend</value>
					<tip lang="true">buttonsend</tip>
					<onclick>if(check_required()) sendmail(0)</onclick>
					<disabled global="page" eval="true">check_user($page,"create")?"false":"true"</disabled>
					<class>nowrap contextmenu</class>
					<icon>fa fa-check</icon>
				</field>
				<field global="id" ifeval="$id==0">
					<type>button</type>
					<value lang="true">buttonsendreturnhere</value>
					<tip lang="true">buttonsendreturnhere</tip>
					<onclick>if(check_required()) sendmail(1)</onclick>
					<disabled global="page" eval="true">check_user($page,"create")?"false":"true"</disabled>
					<class>nowrap contextmenu</class>
					<icon>fa fa-check</icon>
				</field>
				<field global="id" ifeval="$id>=0">
					<type>button</type>
					<value lang="true">buttoncancel</value>
					<tip lang="true">buttoncancel</tip>
					<onclick>cancel()</onclick>
					<class>nowrap contextmenu</class>
					<icon>fa fa-times</icon>
				</field>
				<field global="id" ifeval="$id&lt;0">
					<type>button</type>
					<value lang="true">actionreply</value>
					<tip lang="true">actionreplytip</tip>
					<onclick>reply()</onclick>
					<class>nowrap contextmenu</class>
					<icon>fa fa-reply</icon>
					<disabled global="id" eval="true">execute_query("SELECT is_outbox FROM tbl_correo WHERE id='".abs($id)."'")==0?"false":"true"</disabled>
					<class2 global="id" eval="true">(execute_query("SELECT is_outbox FROM tbl_correo WHERE id='".abs($id)."'")==0 &amp;&amp; execute_query("SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo='".abs($id)."' AND id_tipo IN (2,3)")==1)?"shortcut_ctrl_insert":""</class2>
				</field>
				<field global="id" ifeval="$id&lt;0">
					<type>button</type>
					<value lang="true">actionreplyall</value>
					<tip lang="true">actionreplyalltip</tip>
					<onclick>replyall()</onclick>
					<class>nowrap contextmenu</class>
					<icon>fa fa-reply-all</icon>
					<disabled global="id" eval="true">(execute_query("SELECT is_outbox FROM tbl_correo WHERE id='".abs($id)."'")==0 &amp;&amp; execute_query("SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo='".abs($id)."' AND id_tipo IN (2,3)")>=2)?"false":"true"</disabled>
					<class2 global="id" eval="true">(execute_query("SELECT is_outbox FROM tbl_correo WHERE id='".abs($id)."'")==0 &amp;&amp; execute_query("SELECT COUNT(*) FROM tbl_correo_a WHERE id_correo='".abs($id)."' AND id_tipo IN (2,3)")>=2)?"shortcut_ctrl_insert":""</class2>
				</field>
				<field global="id" ifeval="$id&lt;0">
					<type>button</type>
					<value lang="true">actionforward</value>
					<tip lang="true">actionforwardtip</tip>
					<onclick>forward()</onclick>
					<class>nowrap contextmenu</class>
					<icon>fa fa-share</icon>
				</field>
				<field global="id" ifeval="$id&lt;0">
					<type>button</type>
					<name>delete</name>
					<value lang="true">delete</value>
					<tip lang="true">delete</tip>
					<onclick>delete1()</onclick>
					<disabled global="page,id" eval="true">execute_query("SELECT '1' denied FROM (SELECT a.id,e.id_usuario id_usuario,d.id_grupo id_grupo FROM ".page2table($page)." a LEFT JOIN tbl_registros e ON e.id_aplicacion='".page2id($page)."' AND e.id_registro=a.id AND e.first=1 LEFT JOIN tbl_usuarios d ON e.id_usuario=d.id WHERE a.id='".abs($id)."') z WHERE NOT ".check_sql($page,"delete"))?"true":"false"</disabled>
					<class>nowrap contextmenu</class>
					<icon>fa fa-trash</icon>
				</field>
				<field global="id" ifeval="$id&lt;0">
					<type>button</type>
					<value lang="true">buttonreturn</value>
					<tip lang="true">buttonreturn</tip>
					<onclick>goback()</onclick>
					<class>nowrap contextmenu</class>
					<icon>fa fa-hand-o-left</icon>
				</field>
			</row>
		</buttons>
		<javascript>
			<javascript include="xml/common/jsform.xml" replace="true"/>
			<cache>
				<include>js/correo.js</include>
				<include>js/addtextos.js</include>
			</cache>
			<function>sendmail(returnhere) { addcontent("cancel"); setParam("returnhere",returnhere); setParam("action","sendmail"); submit1(); }</function>
			<function>reply() { setParam("id","0_reply_"+abs(getParam("id"))); submit1(); }</function>
			<function>replyall() { setParam("id","0_replyall_"+abs(getParam("id"))); submit1(); }</function>
			<function>forward() { setParam("id","0_forward_"+abs(getParam("id"))); submit1(); }</function>
			<function eval="true">"lang_msgnumsileidos() { return '".LANG_ESCAPE("msgnumsileidos")."1".LANG_ESCAPE("message1")."'; }"</function>
			<function eval="true">"lang_msgnumnoleidos() { return '".LANG_ESCAPE("msgnumnoleidos")."1".LANG_ESCAPE("message1")."'; }"</function>
			<function eval="true">"lang_msgnumsiwait() { return '".LANG_ESCAPE("msgnumsiwait")."1".LANG_ESCAPE("message1")."'; }"</function>
			<function eval="true">"lang_msgnumnowait() { return '".LANG_ESCAPE("msgnumnowait")."1".LANG_ESCAPE("message1")."'; }"</function>
			<function eval="true">"lang_msgnumsispam() { return '".LANG_ESCAPE("msgnumsispam")."1".LANG_ESCAPE("message1")."'; }"</function>
			<function eval="true">"lang_msgnumnospam() { return '".LANG_ESCAPE("msgnumnospam")."1".LANG_ESCAPE("message1")."'; }"</function>
			<function eval="true">"addincidencia() { dialog(\"".LANG_ESCAPE("confirm")."\",\"".LANG_ESCAPE("addincidenciamsg")."\",{'".LANG_ESCAPE("yes")."':function() { dialog('close'); setParam('action','incidencias'); submit1(); },'".LANG_ESCAPE("no")."':function() { dialog('close'); } }); }"</function>
		</javascript>
	</form>
	<delete>
		<query include="xml/common/qpermdelete.xml" replace="true"/>
		<query global="id" eval="true">make_insert_query("tbl_correo_d",make_select_query("tbl_correo",array(
			"id_cuenta",
			"uidl",
			"datetime"
		),make_where_query(array(
			"id"=>$id,
			"is_outbox"=>0
		))),array(
			"id_cuenta",
			"uidl",
			"datetime"
		))</query>
		<query global="id" eval="true">"SELECT CONCAT('".get_directory("dirs/inboxdir")."',id_cuenta,'/',uidl,'.eml.gz') action_delete FROM tbl_correo WHERE id='$id' AND is_outbox='0'"</query>
		<query global="id" eval="true">"SELECT CONCAT('".get_directory("dirs/outboxdir")."',id_cuenta,'/',uidl,'.eml.gz') action_delete FROM tbl_correo WHERE id='$id' AND is_outbox='1'"</query>
		<query global="id" eval="true">"SELECT CONCAT('".get_directory("dirs/outboxdir")."',id_cuenta,'/',uidl,'.obj') action_delete FROM tbl_correo WHERE id='$id' AND is_outbox='1'"</query>
		<query include="xml/common/qdelete.xml" replace="true" />
		<query global="page,id" eval="true">make_delete_query("tbl_correo_a",make_where_query(array("id_correo"=>$id)))</query>
		<query include="xml/common/qdeletefiles.xml" replace="true" />
		<query include="xml/common/qcontroldelete.xml" replace="true"/>
		<query eval="true">"SELECT '".LANG_ESCAPE("msgnumdelete")."1".LANG_ESCAPE("message1")."' action_alert"</query>
		<query include="xml/common/qfoldersdelete.xml" replace="true"/>
	</delete>
	<pdf>
		<constructor>"P","mm","A4"</constructor>
		<margins>50,30,30,30</margins>
		<query>"SELECT *,
					CASE WHEN para!='' THEN para
					ELSE
						CASE WHEN uc.email_name=''
						THEN uc.email_from
						ELSE CONCAT(uc.email_name,' &lt;',uc.email_from,'&gt;')
						END
					END para,
					CASE WHEN subject='' THEN '".LANG_ESCAPE("sinsubject")."' ELSE subject END subject,
					(SELECT REPLACE(GROUP_CONCAT(CONCAT(fichero,' (',fichero_size,')')),',',', ') FROM
						(SELECT fichero,id_registro,
							CASE
								WHEN fichero_size&gt;=1073741824 THEN CONCAT(ROUND(fichero_size/1073741824.0,2),' Gbytes')
								WHEN fichero_size&gt;=1048576 THEN CONCAT(ROUND(fichero_size/1048576.0,2),' Mbytes')
								WHEN fichero_size&gt;=1024 THEN CONCAT(ROUND(fichero_size/1024.0,2),' Kbytes')
								ELSE CONCAT(fichero_size,' bytes')
							END fichero_size
						 FROM tbl_ficheros WHERE id_aplicacion='".page2id("correo")."') z WHERE id_registro=a.id
					) files
					FROM tbl_correo a
					LEFT JOIN tbl_usuarios_c uc ON a.id_cuenta=uc.id
					WHERE a.id IN (".check_ids(getParam("id")).")"</query>
		<foreach>
			<!-- TEMPLATE -->
			<header>
				<!-- LOGO -->
				<margins>0,0,0,0</margins>
				<image>CONFIG("logo_left"),CONFIG("logo_top"),CONFIG("logo_width"),CONFIG("logo_height"),get_directory("dirs/filesdir").CONFIG("logo_file")</image>
				<!-- PONER MARCA DE AGUA -->
				<font>"normal","B",CONFIG("water_correo_size"),"#eeeeee"</font>
				<text>CONFIG("water_correo_posx"),CONFIG("water_correo_posy"),CONFIG("water_correo_text"),CONFIG("water_correo_angle")</text>
				<margins>50,30,30,30</margins>
				<setxy>30,50</setxy>
			</header>
			<footer>
				<margins>0,0,0,0</margins>
				<!-- PONER PIE DE PAGINA -->
				<font>"normal","",6,CONFIG("color_text2")</font>
				<pageno>30,279,150,0,"R",LANG("paginaspc"),LANG("spcdespc")</pageno>
				<margins>50,30,30,30</margins>
			</footer>
			<!-- BEGIN -->
			<newpage></newpage>
			<color>CONFIG("color_line"),"#000000"</color>
			<!-- DATOS CORREO -->
			<setxy>30,50</setxy>
			<getxy>"x","y"</getxy>
			<font>"normal","B",8,CONFIG("color_text1")</font>
			<textarea>30,$row["y"],25,4,"R",LANG("from")</textarea>
			<font>"mono","",8,CONFIG("color_text2")</font>
			<textarea>55,$row["y"],125,4,"L",$row["de"]</textarea>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<line>30,$row["y"],180,$row["y"]</line>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<font>"normal","B",8,CONFIG("color_text1")</font>
			<textarea>30,$row["y"],25,4,"R",LANG("to")</textarea>
			<font>"mono","",8,CONFIG("color_text2")</font>
			<textarea>55,$row["y"],125,4,"L",$row["para"]</textarea>
			<eval>$row["cc"]</eval>
				<getxy>"x","y"</getxy>
				<setxy>$row["x"],$row["y"]+2</setxy>
				<getxy>"x","y"</getxy>
				<line>30,$row["y"],180,$row["y"]</line>
				<getxy>"x","y"</getxy>
				<setxy>$row["x"],$row["y"]+2</setxy>
				<getxy>"x","y"</getxy>
				<font>"normal","B",8,CONFIG("color_text1")</font>
				<textarea>30,$row["y"],25,4,"R",LANG("cc")</textarea>
				<font>"mono","",8,CONFIG("color_text2")</font>
				<textarea>55,$row["y"],125,4,"L",$row["cc"]</textarea>
			<eval>$row["bcc"]</eval>
				<getxy>"x","y"</getxy>
				<setxy>$row["x"],$row["y"]+2</setxy>
				<getxy>"x","y"</getxy>
				<line>30,$row["y"],180,$row["y"]</line>
				<getxy>"x","y"</getxy>
				<setxy>$row["x"],$row["y"]+2</setxy>
				<getxy>"x","y"</getxy>
				<font>"normal","B",8,CONFIG("color_text1")</font>
				<textarea>30,$row["y"],25,4,"R",LANG("bcc")</textarea>
				<font>"mono","",8,CONFIG("color_text2")</font>
				<textarea>55,$row["y"],125,4,"L",$row["bcc"]</textarea>
			<eval>true</eval>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<line>30,$row["y"],180,$row["y"]</line>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<font>"normal","B",8,CONFIG("color_text1")</font>
			<textarea>30,$row["y"],25,4,"R",LANG("date")</textarea>
			<font>"mono","",8,CONFIG("color_text2")</font>
			<textarea>55,$row["y"],125,4,"L",$row["datetime"]</textarea>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<line>30,$row["y"],180,$row["y"]</line>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<font>"normal","B",8,CONFIG("color_text1")</font>
			<textarea>30,$row["y"],25,4,"R",LANG("subject")</textarea>
			<font>"mono","",8,CONFIG("color_text2")</font>
			<textarea>55,$row["y"],125,4,"L",$row["subject"]</textarea>
			<eval>$row["files"]</eval>
				<getxy>"x","y"</getxy>
				<setxy>$row["x"],$row["y"]+2</setxy>
				<getxy>"x","y"</getxy>
				<line>30,$row["y"],180,$row["y"]</line>
				<getxy>"x","y"</getxy>
				<setxy>$row["x"],$row["y"]+2</setxy>
				<getxy>"x","y"</getxy>
				<font>"normal","B",8,CONFIG("color_text1")</font>
				<textarea>30,$row["y"],25,4,"R",LANG("shortattachments")</textarea>
				<font>"mono","",8,CONFIG("color_text2")</font>
				<textarea>55,$row["y"],125,4,"L",$row["files"]</textarea>
			<eval>true</eval>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<line>30,$row["y"],180,$row["y"]</line>
			<getxy>"x","y"</getxy>
			<setxy>$row["x"],$row["y"]+2</setxy>
			<getxy>"x","y"</getxy>
			<font>"normal","B",8,CONFIG("color_text1")</font>
			<textarea>30,$row["y"],25,4,"R",LANG("message")</textarea>
			<font>"mono","",8,CONFIG("color_text2")</font>
			<textarea>55,$row["y"],125,4,"L",trim($row["body"])</textarea>
		</foreach>
		<output>encode_bad_chars(str_replace(".","",strpos(check_ids(getParam("id")),",")===false?execute_query("
		SELECT
			CONCAT('".LANG_ESCAPE("correo")."',' ',LPAD(id,".intval(CONFIG("zero_padding_digits")).",0),' ',CASE WHEN subject='' THEN '".LANG_ESCAPE("sinsubject")."' ELSE subject END) subject
		FROM tbl_correo WHERE id IN (".check_ids(getParam("id")).")"):LANG("correo"))).".pdf"</output>
	</pdf>
</root>
