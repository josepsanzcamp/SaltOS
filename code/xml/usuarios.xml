<?xml version="1.0" encoding="UTF-8" ?>
<!--
 ____        _ _    ___  ____
/ ___|  __ _| | |_ / _ \/ ___|
\___ \ / _` | | __| | | \___ \
 ___) | (_| | | |_| |_| |___) |
|____/ \__,_|_|\__|\___/|____/

SaltOS: Framework to develop Rich Internet Applications
Copyright (C) 2007-2022 by Josep Sanz CampderrÃ³s
More information in https://www.saltos.org or info@saltos.org

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<root>
    <list>
        <title lang="true">list</title>
        <icon eval="true">ICON("list")</icon>
        <help>true</help>
        <actions include="xml/common/actions.xml" replace="true"/>
        <width>100%</width>
        <fields>
            <field>
                <name>id2</name>
                <label lang="true">id</label>
                <sort>true</sort>
                <order>id</order>
            </field>
            <field>
                <name>login</name>
                <label lang="true">username</label>
                <sort>true</sort>
                <order>login2</order>
                <excel>login2</excel>
            </field>
            <field>
                <name>grupo</name>
                <label lang="true">grupo</label>
                <sort>true</sort>
                <order>grupo2</order>
                <excel>grupo2</excel>
            </field>
            <field>
                <name>nombre</name>
                <label lang="true">nombre</label>
                <sort>true</sort>
                <order>nombre2</order>
                <excel>nombre2</excel>
            </field>
            <field>
                <name>email2</name>
                <label lang="true">email</label>
                <sort>true</sort>
                <excel>email</excel>
            </field>
            <field>
                <name>activo</name>
                <label lang="true">activo</label>
                <sort>false</sort>
            </field>
            <field>
                <name>hora_ini</name>
                <label lang="true">entrada</label>
                <sort>true</sort>
            </field>
            <field>
                <name>hora_fin</name>
                <label lang="true">salida</label>
                <sort>true</sort>
            </field>
            <field>
                <name>dias_sem</name>
                <label lang="true">dias</label>
                <sort>true</sort>
            </field>
            <field>
                <name>logged</name>
                <label lang="true">logged</label>
                <sort>true</sort>
            </field>
        </fields>
        <javascript include="xml/common/jslist.xml"/>
        <form>
            <name>list</name>
            <action></action>
            <method>get</method>
            <fields>
                <title lang="true">filter</title>
                <icon eval="true">ICON("filter")</icon>
                <buttons>true</buttons>
                <popup>true</popup>
                <row>
                    <field include="xml/common/hiddenslist.xml" replace="true" />
                    <field>
                        <name>id_grupo</name>
                        <label lang="true">grupos</label>
                        <type>select</type>
                        <width>240px</width>
                        <query eval="true">"SELECT '' value,'".LANG_ESCAPE("todoslosgrupos")."' label UNION SELECT id value, nombre label FROM tbl_grupos ORDER BY label ASC"</query>
                        <value global="id_grupo" eval="true">$id_grupo=getParam("id_grupo")</value>
                    </field>
                </row>
                <row>
                    <field>
                        <name>activo</name>
                        <label lang="true">activo</label>
                        <type>select</type>
                        <width>240px</width>
                        <query eval="true">"SELECT '' value,'".LANG_ESCAPE("todoslosusuarios")."' label UNION SELECT '1' value, '".LANG_ESCAPE("yes")."' label UNION SELECT '0' value, '".LANG_ESCAPE("no")."' label"</query>
                        <value global="activo" eval="true">$activo=getParam("activo")</value>
                    </field>
                </row>
                <row>
                    <field>
                        <name>filtro</name>
                        <label lang="true">buscar</label>
                        <type>text</type>
                        <width>240px</width>
                        <value global="filtro" eval="true">$filtro=getParam("filtro")</value>
                    </field>
                </row>
            </fields>
            <fields include="xml/common/filters.xml" replace="true" />
            <buttons include="xml/common/buttonslist.xml" />
        </form>
        <quick>
            <row>
                <field>
                    <type>button</type>
                    <value lang="true">create</value>
                    <tip lang="true">create</tip>
                    <onclick>create()</onclick>
                    <icon eval="true">ICON("create")</icon>
                    <class>nowrap contextmenu</class>
                    <class2>shortcut_ctrl_insert</class2>
                    <disabled global="page" eval="true">check_user($page,"create")?"false":"true"</disabled>
                </field>
                <field>
                    <type>copy</type>
                    <name>id_grupo</name>
                    <onchange>buscar()</onchange>
                </field>
                <field>
                    <type>copy</type>
                    <name>activo</name>
                    <onchange>buscar()</onchange>
                </field>
                <field>
                    <type>separator</type>
                    <width>100%</width>
                </field>
                <field global="limit" ifeval="$limit&gt;=200">
                    <type>label</type>
                    <label global="limit" eval="true">str_replace('$limit',$limit,LANG("biglist"))</label>
                    <tip global="limit" eval="true">str_replace('$limit',$limit,LANG("biglisttip"))</tip>
                    <class>nowrap</class>
                    <class2>info</class2>
                </field>
                <field ifeval="!ismobile() &amp;&amp; check_filter(array('filtro'=>'','id_grupo'=>'','activo'=>''))">
                    <type>label</type>
                    <label lang="true">usedfilter</label>
                    <class>nowrap</class>
                    <class2>info</class2>
                </field>
                <field>
                    <type>copy</type>
                    <name>filtro</name>
                    <class>shortcut_ctrl_f</class>
                    <onkey>if(is_enterkey(event)) buscar()</onkey>
                    <focus>true</focus>
                </field>
                <field>
                    <type>copy</type>
                    <name>buscar</name>
                </field>
                <field ifeval="!ismobile()">
                    <type>button</type>
                    <value lang="true">excel</value>
                    <tip lang="true">exceltip</tip>
                    <onclick>excel()</onclick>
                    <icon eval="true">ICON("excel")</icon>
                    <class>nowrap contextmenu</class>
                </field>
                <field>
                    <type>copy</type>
                    <name>limpiar</name>
                    <class>contextmenu</class>
                </field>
            </row>
        </quick>
        <pager include="xml/common/pagerlist.xml"/>
        <query global="page,filtro,activo,id_grupo" eval="true">"SELECT * FROM (SELECT
        LPAD(a.id,".intval(CONFIG("zero_padding_digits")).",0) id2,a.id id,
        CONCAT('link:openapp(\'usuarios\',',-a.id,'):',a.login) login,a.login login2,
        CONCAT('link:openapp(\'grupos\',',-a.id_grupo,'):',b.nombre) grupo,b.nombre grupo2,
        CONCAT('link:openapp(\'',(SELECT codigo FROM tbl_aplicaciones WHERE id=a.id_aplicacion),'\',',-a.id_registro,'):',a_nombre) nombre,a_nombre nombre2,
        CONCAT('mailto:',email) email2, email,
        CASE activo WHEN '1' THEN '".LANG_ESCAPE("yes")."' ELSE '".LANG_ESCAPE("no")."' END activo,
        hora_ini,hora_fin,
CONCAT(
CASE SUBSTR(dias_sem,1,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("lunes"),0,3,"UTF-8")." ' ELSE '' END,
CASE SUBSTR(dias_sem,2,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("martes"),0,3,"UTF-8")." ' ELSE '' END,
CASE SUBSTR(dias_sem,3,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("miercoles"),0,3,"UTF-8")." ' ELSE '' END,
CASE SUBSTR(dias_sem,4,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("jueves"),0,3,"UTF-8")." ' ELSE '' END,
CASE SUBSTR(dias_sem,5,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("viernes"),0,3,"UTF-8")." ' ELSE '' END,
CASE SUBSTR(dias_sem,6,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("sabado"),0,3,"UTF-8")." ' ELSE '' END,
CASE SUBSTR(dias_sem,7,1) WHEN '1' THEN '".mb_substr(LANG_ESCAPE("domingo"),0,3,"UTF-8")." ' ELSE '' END
) dias_sem,
CASE (SELECT COUNT(*) FROM tbl_security WHERE id_usuario=a.id AND logout='0') WHEN 0 THEN '".LANG_ESCAPE("no")."' ELSE '".LANG_ESCAPE("yes")."' END logged,
a.id action_id,
CONCAT(LPAD(a.id,".intval(CONFIG("zero_padding_digits")).",0),' - ',a_nombre) action_title,
CASE ".check_sql($page,"view")." WHEN 1 THEN 'true' ELSE 'false' END action_view,
CASE ".check_sql($page,"edit")." WHEN 1 THEN 'true' ELSE 'false' END action_edit,
CASE ".check_sql($page,"delete")." WHEN 1 THEN 'true' ELSE 'false' END action_delete,
e.id_usuario id_usuario,id_grupo id_grupo FROM (
SELECT id,login,id_grupo,id_aplicacion,id_registro,".make_extra_query("d.")." a_nombre,".make_extra_query_with_field("email","d.")." email,activo,hora_ini,hora_fin,dias_sem FROM tbl_usuarios d
) a
LEFT JOIN tbl_grupos b ON a.id_grupo=b.id
LEFT JOIN tbl_registros e ON e.id_aplicacion='".page2id($page)."' AND e.id_registro=a.id AND e.first=1
WHERE 1=1
AND (activo='$activo' OR ''='$activo')
AND (id_grupo='$id_grupo' OR ''='$id_grupo' OR a.id IN (SELECT id_usuario FROM tbl_usuarios_g WHERE id_grupo='$id_grupo'))
) z
WHERE 1=1
AND ".($filtro!=""?make_fulltext_query3($filtro,$page):"(1=1)")."
AND ".check_sql($page,"list")</query>
        <order global="order" eval="true">$order</order>
        <limit global="limit" eval="true">$limit</limit>
        <offset global="offset" eval="true">$offset</offset>
    </list>
    <form>
        <views>
            <view>
                <title lang="true">formview</title>
                <query>
                    <query include="xml/common/qpermview.xml" replace="true" />
                    <default global="id" eval="true">"SELECT *,
SUBSTR(dias_sem,1,1) lunes,
SUBSTR(dias_sem,2,1) martes,
SUBSTR(dias_sem,3,1) miercoles,
SUBSTR(dias_sem,4,1) jueves,
SUBSTR(dias_sem,5,1) viernes,
SUBSTR(dias_sem,6,1) sabado,
SUBSTR(dias_sem,7,1) domingo
FROM tbl_usuarios WHERE id=".abs($id)</default>
                    <permisos>
                        <permisos global="id" eval="true">"
                        SELECT DISTINCT CONCAT(a.id,'_','-2') id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            -2 id_permiso,
                            'link:permiso_details(this):".LANG_ESCAPE("showdetalles")."' permiso,
                            '0' allow,
                            '0' deny,
                            -2 pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        UNION
                        SELECT DISTINCT CONCAT(a.id,'_','-1') id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            -1 id_permiso,
                            'link:permiso_details(this):".LANG_ESCAPE("hidedetalles")."' permiso,
                            '0' allow,
                            '0' deny,
                            -1 pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        UNION
                        SELECT CONCAT(a.id,'_',b.id) id,
                            a.id id_aplicacion,a.nombre aplicacion,
                            b.id id_permiso,b.nombre permiso,
                            up.allow allow,
                            up.deny deny,
                            pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        LEFT JOIN tbl_permisos b ON b.id=ap.id_permiso
                        LEFT JOIN tbl_usuarios_p up ON ap.id_aplicacion=up.id_aplicacion AND ap.id_permiso=up.id_permiso AND up.id_usuario=".abs($id)."
                        ORDER BY aplicacion,pos"</permisos>
                    </permisos>
                    <grupos>
                        <grupos global="id" eval="true">"
                        SELECT a.id id,a.id id_grupo,a.nombre nombre,CASE WHEN b.id IS NULL THEN 0 ELSE 1 END activado
                        FROM tbl_grupos a
                        LEFT JOIN tbl_usuarios_g b ON b.id_usuario='".abs($id)."' AND a.id=b.id_grupo
                        ORDER BY nombre"</grupos>
                    </grupos>
                    <appsregs>
                        <appsregs global="id" eval="true">make_select_appsregs($id)</appsregs>
                    </appsregs>
                    <gcalendar global="id" eval="true">"SELECT IFNULL(id,'0') id,IFNULL(id_usuario,'".abs($id)."') id_usuario,email,token,COUNT(*) contador FROM tbl_gcalendar WHERE id_usuario='".abs($id)."'"</gcalendar>
                    <feeds_old>
                        <feeds_old global="id" eval="true">"SELECT id,id_usuario,CONCAT('link:openwin(\"',REPLACE(link,':','%3A'),'\"):',title) title,title title2,disabled FROM tbl_usuarios_f WHERE id_usuario='".abs($id)."' ORDER BY title2 ASC"</feeds_old>
                    </feeds_old>
                    <correo_old global="id" eval="true">"SELECT *,CONCAT('?action=signature&amp;id=',id) email_signature FROM tbl_usuarios_c WHERE id_usuario='".abs($id)."' ORDER BY id ASC"</correo_old>
                    <control include="xml/common/qcontrol.xml"/>
                    <folders include="xml/common/qfolders.xml" />
                </query>
            </view>
            <insert>
                <title lang="true">forminsert</title>
                <query>
                    <query include="xml/common/qpermcreate.xml" replace="true" />
                    <default>SELECT '0' id,'0' id_grupo,'00:00:00' hora_ini,'24:00:00' hora_fin,'1' lunes,'1' martes,'1' miercoles,'1' jueves,'1' viernes,'1' sabado,'1' domingo,'1' activo,'0' id_aplicacion,'0' id_registro</default>
                    <permisos>
                        <permisos eval="true">"
                        SELECT DISTINCT CONCAT(a.id,'_','-2') id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            -2 id_permiso,
                            'link:permiso_details(this):".LANG_ESCAPE("showdetalles")."' permiso,
                            '0' allow,
                            '0' deny,
                            -2 pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        UNION
                        SELECT DISTINCT CONCAT(a.id,'_','-1') id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            -1 id_permiso,
                            'link:permiso_details(this):".LANG_ESCAPE("hidedetalles")."' permiso,
                            '0' allow,
                            '0' deny,
                            -1 pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        UNION
                        SELECT CONCAT(a.id,'_',b.id) id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            b.id id_permiso,
                            b.nombre permiso,
                            '0' allow,
                            '0' deny,
                            pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        LEFT JOIN tbl_permisos b ON b.id=ap.id_permiso
                        ORDER BY aplicacion,pos"</permisos>
                    </permisos>
                    <grupos>
                        <grupos eval="true">"
                        SELECT a.id id,a.id id_grupo,a.nombre nombre,'0' activado
                        FROM tbl_grupos a
                        ORDER BY nombre"</grupos>
                    </grupos>
                    <appsregs>
                        <appsregs global="id" eval="true">make_select_appsregs($id)</appsregs>
                    </appsregs>
                    <gcalendar>SELECT '0' id</gcalendar>
                    <feeds_new>SELECT '0' id</feeds_new>
                    <correo_new>SELECT '0' id,'0' pop3_days,'?action=signature&amp;id=0' email_signature</correo_new>
                    <folders include="xml/common/qfolders.xml" />
                </query>
            </insert>
            <update>
                <title lang="true">formupdate</title>
                <query>
                    <query include="xml/common/qpermupdate.xml" replace="true" />
                    <default global="id" eval="true">"SELECT *,
SUBSTR(dias_sem,1,1) lunes,
SUBSTR(dias_sem,2,1) martes,
SUBSTR(dias_sem,3,1) miercoles,
SUBSTR(dias_sem,4,1) jueves,
SUBSTR(dias_sem,5,1) viernes,
SUBSTR(dias_sem,6,1) sabado,
SUBSTR(dias_sem,7,1) domingo
FROM tbl_usuarios WHERE id=".abs($id)</default>
                    <permisos>
                        <permisos global="id" eval="true">"
                        SELECT DISTINCT CONCAT(a.id,'_','-2') id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            -2 id_permiso,
                            'link:permiso_details(this):".LANG_ESCAPE("showdetalles")."' permiso,
                            '0' allow,
                            '0' deny,
                            -2 pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        UNION
                        SELECT DISTINCT CONCAT(a.id,'_','-1') id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            -1 id_permiso,
                            'link:permiso_details(this):".LANG_ESCAPE("hidedetalles")."' permiso,
                            '0' allow,
                            '0' deny,
                            -1 pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        UNION
                        SELECT CONCAT(a.id,'_',b.id) id,
                            a.id id_aplicacion,
                            a.nombre aplicacion,
                            b.id id_permiso,
                            b.nombre permiso,
                            up.allow allow,
                            up.deny deny,
                            pos
                        FROM tbl_aplicaciones_p ap
                        LEFT JOIN tbl_aplicaciones a ON a.id=ap.id_aplicacion
                        LEFT JOIN tbl_permisos b ON b.id=ap.id_permiso
                        LEFT JOIN tbl_usuarios_p up ON ap.id_aplicacion=up.id_aplicacion AND ap.id_permiso=up.id_permiso AND up.id_usuario=".abs($id)."
                        ORDER BY aplicacion,pos"</permisos>
                    </permisos>
                    <grupos>
                        <grupos global="id" eval="true">"
                        SELECT a.id id,a.id id_grupo,a.nombre nombre,CASE WHEN b.id IS NULL THEN 0 ELSE 1 END activado
                        FROM tbl_grupos a
                        LEFT JOIN tbl_usuarios_g b ON b.id_usuario='".abs($id)."' AND a.id=b.id_grupo
                        ORDER BY nombre"</grupos>
                    </grupos>
                    <appsregs>
                        <appsregs global="id" eval="true">make_select_appsregs($id)</appsregs>
                    </appsregs>
                    <gcalendar global="id" eval="true">"SELECT IFNULL(id,'0') id,IFNULL(id_usuario,'".abs($id)."') id_usuario,email,token,COUNT(*) contador FROM tbl_gcalendar WHERE id_usuario='".abs($id)."'"</gcalendar>
                    <feeds_old>
                        <feeds_old global="id" eval="true">"SELECT id,id_usuario,CONCAT('link:openwin(\"',REPLACE(link,':','%3A'),'\"):',title) title,disabled FROM tbl_usuarios_f WHERE id_usuario='".abs($id)."' ORDER BY title ASC"</feeds_old>
                    </feeds_old>
                    <feeds_new global="id" eval="true">"SELECT '0' id,'".abs($id)."' id_usuario"</feeds_new>
                    <correo_old global="id" eval="true">"SELECT *,CONCAT('?action=signature&amp;id=',id) email_signature FROM tbl_usuarios_c WHERE id_usuario='".abs($id)."' ORDER BY id ASC"</correo_old>
                    <correo_new global="id" eval="true">"SELECT '0' id,'".abs($id)."' id_usuario,'0' pop3_days,'?action=signature&amp;id=0' email_signature"</correo_new>
                    <control include="xml/common/qcontrol.xml"/>
                    <folders include="xml/common/qfolders.xml" />
                </query>
            </update>
        </views>
        <name>form</name>
        <action></action>
        <method>post</method>
        <hiddens include="xml/common/hiddensform.xml" />
        <help>true</help>
        <fields>
            <default>
                <fieldset>
                    <width>600px</width>
                    <title lang="true">personaldata</title>
                    <icon eval="true">ICON("form")</icon>
                    <quick global="id" eval="true">$id>=0?"false":"true"</quick>
                    <row>
                        <field>
                            <name>id</name>
                            <type>hidden</type>
                        </field>
                        <field>
                            <name>password</name>
                            <type>hidden</type>
                        </field>
                        <field>
                            <name>login</name>
                            <label lang="true">username</label>
                            <type>text</type>
                            <width>60px</width>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <required>true</required>
                            <colspan>2</colspan>
                        </field>
                        <field>
                            <name>id_grupo</name>
                            <label lang="true">grupo</label>
                            <type>select</type>
                            <width>240px</width>
                            <query eval="true">make_extra_query_with_perms("grupos","tbl_grupos","nombre")." UNION SELECT '0' value,'".LANG_ESCAPE("singrupo")."' label,'-1' pos ORDER BY pos ASC,label ASC,value ASC"</query>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <required>true</required>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>password_new</name>
                            <label lang="true">password</label>
                            <type>password</type>
                            <width>60px</width>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <onchange>update_score();check_passwords()</onchange>
                        </field>
                        <field>
                            <name>score</name>
                            <type>image</type>
                            <width>80px</width>
                            <height>16px</height>
                            <image>?action=score&amp;format=png</image>
                            <phpthumb>false</phpthumb>
                            <class>ui-corner-all score none</class>
                        </field>
                        <field>
                            <name>id_aplicacion</name>
                            <label lang="true">aplicacion</label>
                            <type>select</type>
                            <width>240px</width>
                            <query eval="true">make_extra_query_with_perms("","tbl_aplicaciones","nombre","SELECT id FROM tbl_aplicaciones WHERE islink=1")." UNION SELECT '0' value,'".LANG_ESCAPE("sinaplicacion")."' label,-1 pos ORDER BY pos ASC,label ASC,value ASC"</query>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <required>true</required>
                            <onchange>update_registros()</onchange>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>password_new2</name>
                            <label lang="true">password2</label>
                            <type>password</type>
                            <width>60px</width>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <onchange>check_passwords()</onchange>
                            <colspan>2</colspan>
                        </field>
                        <field>
                            <name>id_registro</name>
                            <label lang="true">registro</label>
                            <type>select</type>
                            <width>240px</width>
                            <query eval="true">"SELECT '0' value,'".LANG_ESCAPE("sinregistro")."' label"</query>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <required>true</required>
                        </field>
                    </row>
                    <row>
                        <field>
                            <type>separator</type>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>activo</name>
                            <label lang="true">activo</label>
                            <tip lang="true">activo_desc</tip>
                            <type>checkbox</type>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <colspan2>4</colspan2>
                        </field>
                    </row>
                    <row>
                        <field>
                            <type>separator</type>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>hora_ini</name>
                            <label lang="true">entrada</label>
                            <type>time</type>
                            <width>60px</width>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <colspan>2</colspan>
                            <required>true</required>
                            <icon eval="true">ICON("clock")</icon>
                        </field>
                        <field>
                            <name>hora_fin</name>
                            <label lang="true">salida</label>
                            <type>time</type>
                            <width>60px</width>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <required>true</required>
                            <icon eval="true">ICON("clock")</icon>
                        </field>
                    </row>
                </fieldset>
                <fieldset>
                    <width>600px</width>
                    <buttons>true</buttons>
                    <row>
                        <field>
                            <name>lunes</name>
                            <type>checkbox</type>
                            <label lang="true">lunes</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                        <field>
                            <name>martes</name>
                            <type>checkbox</type>
                            <label lang="true">martes</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                        <field>
                            <name>miercoles</name>
                            <type>checkbox</type>
                            <label lang="true">miercoles</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                        <field>
                            <name>jueves</name>
                            <type>checkbox</type>
                            <label lang="true">jueves</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                        <field>
                            <name>viernes</name>
                            <type>checkbox</type>
                            <label lang="true">viernes</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                    </row>
                    <row>
                        <field>
                            <name>sabado</name>
                            <type>checkbox</type>
                            <label lang="true">sabado</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                        <field>
                            <name>domingo</name>
                            <type>checkbox</type>
                            <label lang="true">domingo</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                        </field>
                    </row>
                </fieldset>
            </default>
            <permisos>
                <fieldset>
                    <width>700px</width>
                    <title lang="true">permdata</title>
                    <icon eval="true">ICON("form")</icon>
                    <head>
                        <field>
                            <type>label</type>
                            <label lang="true">aplicacion</label>
                            <class>thead</class>
                        </field>
                        <field>
                            <type>label</type>
                            <label lang="true">permiso</label>
                            <class>thead</class>
                        </field>
                        <field>
                            <type>separator</type>
                            <class>thead</class>
                            <colspan>100</colspan>
                        </field>
                    </head>
                    <row>
                        <class>none</class>
                        <field>
                            <type>hidden</type>
                            <name>id_aplicacion</name>
                        </field>
                        <field>
                            <type>hidden</type>
                            <name>id_permiso</name>
                        </field>
                        <field>
                            <type>label</type>
                            <name>aplicacion</name>
                            <class>tbody</class>
                            <width>180px</width>
                        </field>
                        <field>
                            <type>label</type>
                            <name>permiso</name>
                            <class>tbody</class>
                        </field>
                        <field>
                            <type>checkbox</type>
                            <name>allow</name>
                            <label lang="true">allow</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                            <class>tbody</class>
                            <class2>tbody</class2>
                            <onchange>check_allow_deny(this)</onchange>
                        </field>
                        <field>
                            <type>checkbox</type>
                            <name>deny</name>
                            <label lang="true">deny</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                            <class>tbody</class>
                            <class2>tbody</class2>
                            <onchange>check_allow_deny(this)</onchange>
                        </field>
                    </row>
                </fieldset>
            </permisos>
            <grupos>
                <fieldset>
                    <width>700px</width>
                    <title lang="true">groupsdata</title>
                    <icon eval="true">ICON("form")</icon>
                    <head>
                        <field>
                            <type>label</type>
                            <label lang="true">grupos</label>
                            <class>thead</class>
                        </field>
                        <field>
                            <type>separator</type>
                            <class>thead</class>
                            <colspan>100</colspan>
                        </field>
                    </head>
                    <row>
                        <field>
                            <type>hidden</type>
                            <name>id_grupo</name>
                        </field>
                        <field>
                            <type>label</type>
                            <name>nombre</name>
                            <class>tbody</class>
                        </field>
                        <field>
                            <type>checkbox</type>
                            <name>activado</name>
                            <label lang="true">activar</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                            <class>tbody</class>
                            <class2>tbody</class2>
                        </field>
                    </row>
                </fieldset>
            </grupos>
            <appsregs>
                <fieldset>
                    <width>700px</width>
                    <title lang="true">appsregsdata</title>
                    <icon eval="true">ICON("form")</icon>
                    <head>
                        <field>
                            <type>label</type>
                            <label lang="true">aplicacion</label>
                            <class>thead</class>
                        </field>
                        <field>
                            <type>label</type>
                            <label lang="true">registro</label>
                            <class>thead</class>
                        </field>
                        <field>
                            <type>separator</type>
                            <class>thead</class>
                            <colspan>100</colspan>
                        </field>
                    </head>
                    <row>
                        <class>none</class>
                        <field>
                            <type>hidden</type>
                            <name>id_aplicacion</name>
                        </field>
                        <field>
                            <type>hidden</type>
                            <name>id_registro</name>
                        </field>
                        <field>
                            <type>label</type>
                            <name>aplicacion</name>
                            <class>tbody</class>
                            <width>180px</width>
                        </field>
                        <field>
                            <type>label</type>
                            <name>registro</name>
                            <class>tbody</class>
                        </field>
                        <field>
                            <type>checkbox</type>
                            <name>activado</name>
                            <label lang="true">activar</label>
                            <value>1</value>
                            <readonly global="id" eval="true">$id>=0?"false":"true"</readonly>
                            <width>1px</width>
                            <width2>1px</width2>
                            <class>tbody</class>
                            <class2>tbody</class2>
                            <onchange>check_activado(this)</onchange>
                        </field>
                    </row>
                </fieldset>
            </appsregs>
            <gcalendar>
                <include include="xml/common/gcalendar.xml" replace="true" />
                <node path="fieldset/buttons" replace="true">
                    <buttons>false</buttons>
                </node>
            </gcalendar>
            <feeds include="xml/common/feedstest.xml" replace="true" />
            <node path="feeds_old/fieldset/buttons" replace="true">
                <buttons>false</buttons>
            </node>
            <node path="feeds_new/fieldset/buttons" replace="true">
                <buttons>false</buttons>
            </node>
            <correo_old>
                <fieldset>
                    <title lang="true">correo</title>
                    <icon eval="true">ICON("correo")</icon>
                    <row include="xml/common/correo.xml" replace="true"/>
                    <row>
                        <field global="id" ifeval="$id>0">
                            <name>delete</name>
                            <label lang="true">emaildelete</label>
                            <type>checkbox</type>
                            <value>1</value>
                            <colspan>10</colspan>
                        </field>
                    </row>
                </fieldset>
            </correo_old>
            <correo_new>
                <fieldset>
                    <title lang="true">correonew</title>
                    <icon eval="true">ICON("correo")</icon>
                    <row include="xml/common/correo.xml" replace="true"/>
                </fieldset>
            </correo_new>
            <control include="xml/common/control.xml" />
            <folders include="xml/common/folders.xml" />
        </fields>
        <quick include="xml/common/quickform.xml" />
        <buttons include="xml/common/buttonsform.xml" />
        <javascript>
            <javascript include="xml/common/jsform.xml" replace="true"/>
            <cache>
                <include>js/grupos.js</include>
                <include>js/feedstest.js</include>
                <include>js/updateregistros.js</include>
            </cache>
        </javascript>
    </form>
    <insert>
        <query include="xml/common/qpermcreate.xml" replace="true"/>
        <query match="default" prefix="true" eval="true">getParam("password_new")?"SELECT '".LANG_ESCAPE("errorpassword")."' action_error,'0' action_commit FROM (SELECT 1) t WHERE '".getParam("password_new")."'!='".getParam("password_new2")."'":""</query>
        <query match="default" prefix="true" eval="true">setParam("password",hash_password(getParam("password_new")))</query>
        <query match="default" prefix="true" eval="true">setParam("dias_sem",intval(getParam("lunes")).intval(getParam("martes")).intval(getParam("miercoles")).intval(getParam("jueves")).intval(getParam("viernes")).intval(getParam("sabado")).intval(getParam("domingo")))</query>
        <query match="default" prefix="true" global="page" preeval="true" eval="true">preeval_insert_query(page2table($page))</query>
        <query match="permisos" prefix="true" eval="true">((getParam("allow") || getParam("deny")) &amp;&amp; getParam("id_permiso")>0)?make_insert_query("tbl_usuarios_p",array(
            "id_aplicacion"=>intval(getParam("id_aplicacion")),
            "id_permiso"=>intval(getParam("id_permiso")),
            "allow"=>intval(getParam("allow")),
            "deny"=>intval(getParam("deny")),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM tbl_usuarios"),
        )):""</query>
        <query match="grupos" prefix="true" eval="true">getParam("activado")?make_insert_query("tbl_usuarios_g",array(
            "id_grupo"=>intval(getParam("id_grupo")),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM tbl_usuarios"),
        )):""</query>
        <query match="appsregs" prefix="true" eval="true">(getParam("activado") &amp;&amp; getParam("id_registro")>0)?make_insert_query("tbl_usuarios_r",array(
            "id_aplicacion"=>intval(getParam("id_aplicacion")),
            "id_registro"=>intval(getParam("id_registro")),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM tbl_usuarios"),
        )):""</query>
        <query match="gcalendar" prefix="true" eval="true">getParam("email")||getParam("token")?make_insert_query("tbl_gcalendar",array(
            "email"=>getParam("email"),
            "token"=>getParam("token"),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM tbl_usuarios"),
        )):""</query>
        <query match="feeds_new" prefix="true" eval="true">getParam("url") &amp;&amp; getParam("title")?make_insert_query("tbl_usuarios_f",array(
            "url"=>getParam("url"),
            "title"=>getParam("title"),
            "description"=>getParam("description"),
            "image"=>getParam("image"),
            "link"=>getParam("link"),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM tbl_usuarios"),
        )):""</query>
        <query match="correo_new" prefix="true" eval="true">getParam("email_name")||getParam("email_from")||getParam("email_signature_new")||getParam("pop3_host")||getParam("pop3_port")||getParam("pop3_extra")||getParam("pop3_user")||getParam("pop3_pass")||getParam("pop3_delete")||getParam("pop3_days")||getParam("smtp_host")||getParam("smtp_port")||getParam("smtp_extra")||getParam("smtp_user")||getParam("smtp_pass")||intval(getParam("email_disabled"))||intval(getParam("email_privated"))||intval(getParam("email_default"))||intval(getParam("email_addmetocc"))||intval(getParam("email_crt"))?make_insert_query("tbl_usuarios_c",array(
            "email_name"=>getParam("email_name"),
            "email_from"=>getParam("email_from"),
            "email_signature"=>getParam("email_signature_new"),
            "email_signature_file"=>getParam("email_signature_new_file"),
            "email_signature_type"=>getParam("email_signature_new_type"),
            "email_signature_size"=>intval(getParam("email_signature_new_size")),
            "pop3_host"=>getParam("pop3_host"),
            "pop3_port"=>getParam("pop3_port"),
            "pop3_extra"=>getParam("pop3_extra"),
            "pop3_user"=>getParam("pop3_user"),
            "pop3_pass"=>getParam("pop3_pass"),
            "pop3_delete"=>intval(getParam("pop3_delete")),
            "pop3_days"=>intval(getParam("pop3_days")),
            "smtp_host"=>getParam("smtp_host"),
            "smtp_port"=>getParam("smtp_port"),
            "smtp_extra"=>getParam("smtp_extra"),
            "smtp_user"=>getParam("smtp_user"),
            "smtp_pass"=>getParam("smtp_pass"),
            "email_disabled"=>intval(getParam("email_disabled")),
            "email_privated"=>intval(getParam("email_privated")),
            "email_default"=>intval(getParam("email_default")),
            "email_addmetocc"=>intval(getParam("email_addmetocc")),
            "email_crt"=>intval(getParam("email_crt")),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM tbl_usuarios"),
        )):""</query>
        <query global="page" match="default" prefix="true" eval="true">make_insert_query("tbl_registros",array(
            "id_aplicacion"=>page2id($page),
            "id_registro"=>execute_query("SELECT MAX(id) FROM ".page2table($page)),
            "id_usuario"=>execute_query("SELECT MAX(id) FROM ".page2table($page)),
            "datetime"=>current_datetime(),
            "first"=>1
        ))</query>
        <query global="page" match="default" prefix="true" eval="true">make_control(page2id($page))?"":""</query>
        <query global="page" match="default" prefix="true" eval="true">make_indexing(page2id($page))?"":""</query>
        <query include="xml/common/qfoldersinsert.xml" replace="true"/>
    </insert>
    <update>
        <query include="xml/common/qpermupdate.xml" replace="true"/>
        <query match="default" prefix="true" eval="true">getParam("password_new")?"SELECT '".LANG_ESCAPE("errorpassword")."' action_error,'0' action_commit FROM (SELECT 1) t WHERE '".getParam("password_new")."'!='".getParam("password_new2")."'":""</query>
        <query match="default" prefix="true" eval="true">setParam("dias_sem",intval(getParam("lunes")).intval(getParam("martes")).intval(getParam("miercoles")).intval(getParam("jueves")).intval(getParam("viernes")).intval(getParam("sabado")).intval(getParam("domingo")))</query>
        <query match="default" prefix="true" global="page" preeval="true" eval="true">preeval_update_query(page2table($page))</query>
        <query match="default" prefix="true" global="id" eval="true">getParam("password_new")?make_update_query("tbl_usuarios",array(
            "password"=>hash_password(getParam("password_new"))
        ),make_where_query(array(
            "id"=>abs($id)
        ))):""</query>
        <query match="default" prefix="true" global="id" eval="true">"DELETE FROM tbl_usuarios_p WHERE ".make_where_query(array("id_usuario"=>abs($id)))</query>
        <query match="permisos" prefix="true" global="id" eval="true">((getParam("allow") || getParam("deny")) &amp;&amp; getParam("id_permiso")>0)?make_insert_query("tbl_usuarios_p",array(
            "id_usuario"=>abs($id),
            "id_aplicacion"=>intval(getParam("id_aplicacion")),
            "id_permiso"=>intval(getParam("id_permiso")),
            "allow"=>intval(getParam("allow")),
            "deny"=>intval(getParam("deny"))
        )):""</query>
        <query match="default" prefix="true"  global="id" eval="true">"DELETE FROM tbl_usuarios_g WHERE ".make_where_query(array("id_usuario"=>abs($id)))</query>
        <query match="grupos" prefix="true" global="id" eval="true">getParam("activado")?make_insert_query("tbl_usuarios_g",array(
            "id_usuario"=>abs($id),
            "id_grupo"=>intval(getParam("id_grupo"))
        )):""</query>
        <query match="default" prefix="true" global="id" eval="true">"DELETE FROM tbl_usuarios_r WHERE ".make_where_query(array("id_usuario"=>abs($id)))</query>
        <query match="appsregs" prefix="true" global="id" eval="true">(getParam("activado") &amp;&amp; getParam("id_registro")>0)?make_insert_query("tbl_usuarios_r",array(
            "id_usuario"=>abs($id),
            "id_aplicacion"=>intval(getParam("id_aplicacion")),
            "id_registro"=>intval(getParam("id_registro"))
        )):""</query>
        <query match="gcalendar" prefix="true" global="id" eval="true">execute_query("SELECT COUNT(*) FROM tbl_gcalendar WHERE id_usuario='".abs($id)."'")?make_update_query("tbl_gcalendar",array(
            "email"=>getParam("email"),
            "token"=>getParam("token")
        ),make_where_query(array(
            "id_usuario"=>abs($id)
        ))):(getParam("login")||getParam("password")?make_insert_query("tbl_gcalendar",array(
            "id_usuario"=>abs($id),
            "email"=>getParam("email"),
            "token"=>getParam("token")
        )):"")</query>
        <query match="feeds_old" prefix="true" global="id" eval="true">getParam("feeds_del")?"DELETE FROM tbl_registros WHERE id_registro IN (SELECT id FROM tbl_feeds WHERE id_feed='".abs($id)."') AND id_aplicacion='".page2id("feeds")."'":""</query>
        <query match="feeds_old" prefix="true" global="id" eval="true">getParam("feeds_del")?"DELETE FROM tbl_feeds WHERE ".make_where_query(array("id_feed"=>abs($id))):""</query>
        <query match="feeds_old" prefix="true" global="id" eval="true">getParam("feeds_del")?"DELETE FROM tbl_feeds_d WHERE ".make_where_query(array("id_feed"=>abs($id))):""</query>
        <query match="feeds_old" prefix="true" global="id" eval="true">getParam("feeds_del")?"DELETE FROM tbl_usuarios_f WHERE ".make_where_query(array(
            "id"=>abs($id)
        )):make_update_query("tbl_usuarios_f",array(
            "disabled"=>intval(getParam("disabled"))
        ),make_where_query(array(
            "id"=>abs($id)
        )))</query>
        <query match="feeds_new" prefix="true" global="id" eval="true">getParam("url") &amp;&amp; getParam("title") &amp;&amp; !execute_query("SELECT COUNT(*) FROM tbl_usuarios_f WHERE url='".getParam("url")."' AND id_usuario='".abs($id)."'")?make_insert_query("tbl_usuarios_f",array(
            "id_usuario"=>abs($id),
            "url"=>getParam("url"),
            "title"=>getParam("title"),
            "description"=>getParam("description"),
            "image"=>getParam("image"),
            "link"=>getParam("link")
        )):""</query>
        <query match="correo_old" prefix="true" eval="true">getParam("email_signature_new")?"SELECT email_signature_file action_delete FROM tbl_usuarios_c WHERE id='".getParam("id")."' AND email_signature_file!=''":""</query>
        <query match="correo_old" prefix="true" eval="true">getParam("email_signature_new")?make_update_query("tbl_usuarios_c",array(
            "email_signature"=>getParam("email_signature_new"),
            "email_signature_file"=>getParam("email_signature_new_file"),
            "email_signature_type"=>getParam("email_signature_new_type"),
            "email_signature_size"=>intval(getParam("email_signature_new_size"))
        ),make_where_query(array(
            "id"=>intval(getParam("id"))
        ))):""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"DELETE FROM tbl_registros WHERE id_registro IN (SELECT id FROM tbl_correo WHERE id_cuenta='".abs($id)."') AND id_aplicacion='".page2id("correo")."'":""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"DELETE FROM tbl_correo_a WHERE id_correo IN (SELECT id FROM tbl_correo WHERE id_cuenta='".abs($id)."')":""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"SELECT CONCAT('".get_directory("dirs/inboxdir")."',id_cuenta,'/',uidl,'.eml.gz') action_delete FROM tbl_correo WHERE id_cuenta='".abs($id)."' AND is_outbox='0'":""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"SELECT CONCAT('".get_directory("dirs/outboxdir")."',id_cuenta,'/',uidl,'.eml.gz') action_delete FROM tbl_correo WHERE id_cuenta='".abs($id)."' AND is_outbox='1'":""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"SELECT CONCAT('".get_directory("dirs/outboxdir")."',id_cuenta,'/',uidl,'.obj') action_delete FROM tbl_correo WHERE id_cuenta='".abs($id)."' AND is_outbox='1'":""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"DELETE FROM tbl_correo WHERE ".make_where_query(array("id_cuenta"=>abs($id))):""</query>
        <query match="correo_old" prefix="true" global="id" eval="true">getParam("delete")?"DELETE FROM tbl_correo_d WHERE ".make_where_query(array("id_cuenta"=>abs($id))):""</query>
        <query match="correo_old" prefix="true" eval="true">getParam("delete")?"SELECT email_signature_file action_delete FROM tbl_usuarios_c WHERE id='".getParam("id")."' AND email_signature_file!=''":""</query>
        <query match="correo_old" prefix="true" eval="true">getParam("delete")?"DELETE FROM tbl_usuarios_c WHERE ".make_where_query(array(
            "id"=>intval(getParam("id"))
        )):make_update_query("tbl_usuarios_c",array(
            "email_name"=>getParam("email_name"),
            "email_from"=>getParam("email_from"),
            "pop3_host"=>getParam("pop3_host"),
            "pop3_port"=>getParam("pop3_port"),
            "pop3_extra"=>getParam("pop3_extra"),
            "pop3_user"=>getParam("pop3_user"),
            "pop3_pass"=>getParam("pop3_pass"),
            "pop3_delete"=>intval(getParam("pop3_delete")),
            "pop3_days"=>intval(getParam("pop3_days")),
            "smtp_host"=>getParam("smtp_host"),
            "smtp_port"=>getParam("smtp_port"),
            "smtp_extra"=>getParam("smtp_extra"),
            "smtp_user"=>getParam("smtp_user"),
            "smtp_pass"=>getParam("smtp_pass"),
            "email_disabled"=>intval(getParam("email_disabled")),
            "email_privated"=>intval(getParam("email_privated")),
            "email_default"=>intval(getParam("email_default")),
            "email_addmetocc"=>intval(getParam("email_addmetocc")),
            "email_crt"=>intval(getParam("email_crt"))
        ),make_where_query(array(
            "id"=>intval(getParam("id"))
        )))</query>
        <query match="correo_new" prefix="true" global="correo_new" eval="true">($correo_new=getParam("email_name")||getParam("email_from")||getParam("email_signature_new")||getParam("pop3_host")||getParam("pop3_port")||getParam("pop3_extra")||getParam("pop3_user")||getParam("pop3_pass")||getParam("pop3_delete")||getParam("pop3_days")||getParam("smtp_host")||getParam("smtp_port")||getParam("smtp_extra")||getParam("smtp_user")||getParam("smtp_pass")||intval(getParam("email_disabled"))||intval(getParam("email_privated"))||intval(getParam("email_default"))||intval(getParam("email_addmetocc"))||intval(getParam("email_crt")))?"":""</query>
        <query match="correo_new" prefix="true" global="correo_new" eval="true">$correo_new?"SELECT 'php/action/correo.php' action_include":""</query>
        <query match="correo_new" prefix="true" global="correo_new,id" eval="true">$correo_new?make_insert_query("tbl_usuarios_c",array(
            "id_usuario"=>abs($id),
            "email_name"=>getParam("email_name"),
            "email_from"=>getParam("email_from"),
            "email_signature"=>getParam("email_signature_new"),
            "email_signature_file"=>getParam("email_signature_new_file"),
            "email_signature_type"=>getParam("email_signature_new_type"),
            "email_signature_size"=>intval(getParam("email_signature_new_size")),
            "pop3_host"=>getParam("pop3_host"),
            "pop3_port"=>getParam("pop3_port"),
            "pop3_extra"=>getParam("pop3_extra"),
            "pop3_user"=>getParam("pop3_user"),
            "pop3_pass"=>getParam("pop3_pass"),
            "pop3_delete"=>intval(getParam("pop3_delete")),
            "pop3_days"=>intval(getParam("pop3_days")),
            "smtp_host"=>getParam("smtp_host"),
            "smtp_port"=>getParam("smtp_port"),
            "smtp_extra"=>getParam("smtp_extra"),
            "smtp_user"=>getParam("smtp_user"),
            "smtp_pass"=>getParam("smtp_pass"),
            "email_disabled"=>intval(getParam("email_disabled")),
            "email_privated"=>intval(getParam("email_privated")),
            "email_default"=>intval(getParam("email_default")),
            "email_addmetocc"=>intval(getParam("email_addmetocc")),
            "email_crt"=>intval(getParam("email_crt"))
        )):""</query>
        <query include="xml/common/qcontrolupdate.xml" replace="true"/>
        <query include="xml/common/qfoldersupdate.xml" replace="true"/>
    </update>
    <delete>
        <query include="xml/common/qpermdelete.xml" replace="true"/>
        <query include="xml/common/qdelete.xml" replace="true" />
        <query global="id" eval="true">"DELETE FROM tbl_usuarios_p WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_usuarios_g WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_registros WHERE id_registro IN (SELECT id FROM tbl_correo WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id')) AND id_aplicacion='".page2id("correo")."'"</query>
        <query global="id" eval="true">"DELETE FROM tbl_correo_a WHERE id_correo IN (SELECT id FROM tbl_correo WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id'))"</query>
        <query global="id" eval="true">"SELECT CONCAT('".get_directory("dirs/inboxdir")."',id_cuenta,'/',uidl,'.eml.gz') action_delete FROM tbl_correo WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id') AND is_outbox='0'"</query>
        <query global="id" eval="true">"SELECT CONCAT('".get_directory("dirs/outboxdir")."',id_cuenta,'/',uidl,'.eml.gz') action_delete FROM tbl_correo WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id') AND is_outbox='1'"</query>
        <query global="id" eval="true">"SELECT CONCAT('".get_directory("dirs/outboxdir")."',id_cuenta,'/',uidl,'.obj') action_delete FROM tbl_correo WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id') AND is_outbox='1'"</query>
        <query global="id" eval="true">"DELETE FROM tbl_correo WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id')"</query>
        <query global="id" eval="true">"DELETE FROM tbl_correo_d WHERE id_cuenta IN (SELECT id FROM tbl_usuarios_c WHERE id_usuario='$id')"</query>
        <query global="id" eval="true">"SELECT email_signature_file action_delete FROM tbl_usuarios_c WHERE id_usuario='$id' AND email_signature_file!=''"</query>
        <query global="id" eval="true">"DELETE FROM tbl_usuarios_c WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_registros WHERE id_registro IN (SELECT id FROM tbl_feeds WHERE id_feed IN (SELECT id FROM tbl_usuarios_f WHERE id_usuario='$id')) AND id_aplicacion='".page2id("feeds")."'"</query>
        <query global="id" eval="true">"DELETE FROM tbl_feeds WHERE id_feed IN (SELECT id FROM tbl_usuarios_f WHERE id_usuario='$id')"</query>
        <query global="id" eval="true">"DELETE FROM tbl_feeds_d WHERE id_feed IN (SELECT id FROM tbl_usuarios_f WHERE id_usuario='$id')"</query>
        <query global="id" eval="true">"DELETE FROM tbl_usuarios_f WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_gcalendar WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query include="xml/common/qcontroldelete.xml" replace="true"/>
        <query include="xml/common/qfoldersdelete.xml" replace="true"/>
        <query global="id" eval="true">"DELETE FROM tbl_cookies WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_filters WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_folders WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_history WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_lastfolder WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_lastpage WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
        <query global="id" eval="true">"DELETE FROM tbl_quick WHERE ".make_where_query(array("id_usuario"=>intval($id)))</query>
    </delete>
    <excel>
        <query require="php/listsim.php" global="page" eval="true">list_simulator($page,"excel")</query>
    </excel>
</root>
